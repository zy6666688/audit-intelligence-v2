# 📊 审计业务循环节点设计

**基于实际审计工作流程**  
**版本**: v2.0  
**更新日期**: 2025-12-03

---

## 🎯 设计理念

根据实际审计工作，审计师按**业务循环**分工协作：
- 不同人负责不同循环
- 每个循环有标准的审计程序
- 数据可以在循环间流转
- 最终汇总形成审计报告

---

## 📋 审计业务循环分类

```
审计项目
├─ 资产循环（Asset Cycle）
│  ├─ 固定资产盘点
│  ├─ 存货盘点
│  ├─ 无形资产核查
│  └─ 资产减值测试
│
├─ 采购循环（Procurement Cycle）
│  ├─ 采购订单核查
│  ├─ 应付账款确认
│  ├─ 供应商对账
│  └─ 采购合同审查
│
├─ 销售循环（Sales Cycle）
│  ├─ 销售收入确认
│  ├─ 应收账款函证
│  ├─ 客户对账
│  └─ 销售合同审查
│
├─ 工资循环（Payroll Cycle）
│  ├─ 工资表核对
│  ├─ 社保公积金检查
│  ├─ 个税计算验证
│  └─ 人员花名册核对
│
├─ 现金循环（Cash Cycle）
│  ├─ 库存现金盘点
│  ├─ 银行存款函证
│  ├─ 银行对账单核对
│  └─ 资金流水分析
│
├─ 成本循环（Cost Cycle）
│  ├─ 成本计算核查
│  ├─ 费用报销审查
│  ├─ 成本分摊检查
│  └─ 预算执行分析
│
└─ 税务循环（Tax Cycle）
   ├─ 增值税核算
   ├─ 所得税计算
   ├─ 税务申报检查
   └─ 发票真伪验证
```

---

## 🔧 节点类型设计

### 一、输入节点（Input Nodes）

```typescript
// 1. 数据导入节点
- ExcelImport: Excel文件导入
- CSVImport: CSV文件导入
- DatabaseQuery: 数据库查询
- APIFetch: API数据获取
- ManualInput: 手工录入

// 2. 文件上传节点
- InvoiceUpload: 发票上传
- ContractUpload: 合同上传
- ReportUpload: 报表上传
- PhotoUpload: 实物照片上传（盘点用）
```

---

### 二、资产循环节点（Asset Cycle Nodes）

#### 2.1 固定资产盘点节点
```yaml
节点名称: FixedAssetInventory
负责人: 资产循环审计师
功能:
  - 导入固定资产明细表
  - 现场盘点记录
  - 盘盈盘亏分析
  - 生成盘点底稿

输入:
  - 固定资产明细账（Excel/CSV）
  - 实物照片（Photo）
  - 盘点表（Manual）

处理:
  - 账实核对
  - 差异分析
  - 折旧计算验证
  - 产权证明检查

输出:
  - 盘点结果表
  - 差异清单
  - 盘点底稿
  - 风险提示

AI能力:
  - 图像识别（识别资产编号）
  - 异常检测（盘点差异分析）
  - 折旧计算验证
```

#### 2.2 存货盘点节点
```yaml
节点名称: InventoryCount
负责人: 资产循环审计师
功能:
  - 存货明细导入
  - 盘点数量记录
  - 计价测试
  - 减值测试

输入:
  - 存货明细账
  - 盘点记录表
  - 采购发票
  - 销售出库单

处理:
  - 数量核对
  - 计价验证（先进先出/加权平均）
  - 跌价准备计算
  - 呆滞库存分析

输出:
  - 盘点结果
  - 减值测试表
  - 异常库存清单

AI能力:
  - OCR识别库存标签
  - 呆滞库存预测
  - 跌价准备建议
```

---

### 三、采购循环节点（Procurement Cycle Nodes）

#### 3.1 采购订单核查节点
```yaml
节点名称: PurchaseOrderReview
负责人: 采购循环审计师
功能:
  - 采购订单审查
  - 三单匹配（订单/入库/发票）
  - 价格波动分析
  - 供应商集中度分析

输入:
  - 采购订单
  - 入库单
  - 采购发票
  - 供应商清单

处理:
  - 三单匹配验证
  - 价格合理性测试
  - 审批流程检查
  - 供应商关联方识别

输出:
  - 匹配差异表
  - 价格异常清单
  - 审批缺陷记录

AI能力:
  - 三单智能匹配
  - 关联方识别
  - 价格异常检测
```

#### 3.2 应付账款确认节点
```yaml
节点名称: AccountsPayableConfirm
负责人: 采购循环审计师
功能:
  - 应付账款明细核对
  - 账龄分析
  - 供应商对账函证
  - 期后付款检查

输入:
  - 应付账款明细账
  - 供应商对账单
  - 期后付款凭证

处理:
  - 余额核对
  - 账龄分析
  - 异常账款识别
  - 坏账准备测试

输出:
  - 对账结果
  - 账龄分析表
  - 异常账款清单

AI能力:
  - 自动对账
  - 异常账款识别
```

---

### 四、销售循环节点（Sales Cycle Nodes）

#### 4.1 销售收入确认节点
```yaml
节点名称: RevenueRecognition
负责人: 销售循环审计师
功能:
  - 收入确认测试
  - 截止测试
  - 收入真实性验证
  - 虚假交易识别

输入:
  - 销售明细账
  - 销售合同
  - 出库单
  - 销售发票

处理:
  - 五步法确认测试
  - 截止性测试
  - 收入配比分析
  - 关联方交易识别

输出:
  - 收入测试底稿
  - 截止测试表
  - 虚假交易提示

AI能力:
  - 虚假交易识别
  - 收入确认建议
  - 异常模式检测
```

#### 4.2 应收账款函证节点
```yaml
节点名称: AccountsReceivableConfirm
负责人: 销售循环审计师
功能:
  - 应收账款明细核对
  - 函证管理
  - 账龄分析
  - 坏账准备测试

输入:
  - 应收账款明细账
  - 客户回函
  - 期后回款记录

处理:
  - 函证差异核对
  - 账龄分析
  - 回款能力评估
  - 坏账准备计算

输出:
  - 函证结果汇总
  - 账龄分析表
  - 坏账准备测试表

AI能力:
  - 回款预测
  - 坏账风险评分
```

---

### 五、工资循环节点（Payroll Cycle Nodes）

#### 5.1 工资表核对节点
```yaml
节点名称: PayrollReconciliation
负责人: 工资循环审计师
功能:
  - 工资表核对
  - 工资计算验证
  - 个税计算检查
  - 异常工资识别

输入:
  - 工资明细表
  - 考勤记录
  - 劳动合同
  - 个税申报表

处理:
  - 工资计算重算
  - 个税计算验证
  - 社保基数检查
  - 异常工资识别

输出:
  - 工资核对表
  - 计算差异清单
  - 异常工资报告

AI能力:
  - 工资计算验证
  - 个税计算验证
  - 异常工资识别（虚假员工）
```

#### 5.2 人员花名册核对节点
```yaml
节点名称: EmployeeRosterVerify
负责人: 工资循环审计师
功能:
  - 人员真实性验证
  - 入离职检查
  - 社保缴纳核对

输入:
  - 人员花名册
  - 社保缴纳清单
  - 劳动合同

处理:
  - 在职人员核对
  - 虚假员工识别
  - 社保匹配检查

输出:
  - 人员核对表
  - 虚假员工提示

AI能力:
  - 虚假员工识别
  - 异常模式检测
```

---

### 六、现金循环节点（Cash Cycle Nodes）

#### 6.1 库存现金盘点节点
```yaml
节点名称: CashCount
负责人: 现金循环审计师
功能:
  - 现金盘点
  - 现金日记账核对
  - 大额现金分析
  - 白条检查

输入:
  - 现金盘点表（现场）
  - 现金日记账
  - 现金收支凭证

处理:
  - 账实核对
  - 大额现金分析
  - 白条合规性检查
  - 现金流合理性分析

输出:
  - 盘点结果
  - 账实差异表
  - 大额现金清单
  - 白条清单

AI能力:
  - 异常现金交易识别
  - 现金流合理性分析
```

#### 6.2 银行对账单核对节点
```yaml
节点名称: BankReconciliation
负责人: 现金循环审计师
功能:
  - 银行对账单核对
  - 未达账项分析
  - 银行函证
  - 资金流水分析

输入:
  - 银行存款日记账
  - 银行对账单
  - 银行回函

处理:
  - 银行余额调节表编制
  - 未达账项合理性分析
  - 大额资金流水检查
  - 异常交易识别

输出:
  - 银行余额调节表
  - 未达账项清单
  - 异常交易报告

AI能力:
  - 自动对账
  - 异常交易识别
  - 洗钱风险检测
```

---

### 七、成本循环节点（Cost Cycle Nodes）

#### 7.1 成本计算核查节点
```yaml
节点名称: CostCalculationReview
负责人: 成本循环审计师
功能:
  - 成本计算方法检查
  - 成本归集分配测试
  - 成本费用配比分析

输入:
  - 成本明细账
  - 生产数据
  - 费用分配表

处理:
  - 成本计算重算
  - 分配方法合理性测试
  - 成本波动分析

输出:
  - 成本测试底稿
  - 异常成本清单

AI能力:
  - 成本异常检测
  - 成本预测
```

---

### 八、税务循环节点（Tax Cycle Nodes）

#### 8.1 增值税核算节点
```yaml
节点名称: VATReconciliation
负责人: 税务循环审计师
功能:
  - 增值税申报表复核
  - 进销项税额验证
  - 发票真伪验证
  - 税负率分析

输入:
  - 增值税申报表
  - 进项发票清单
  - 销项发票清单
  - 税务系统数据

处理:
  - 申报表复核
  - 发票真伪验证
  - 进销项匹配
  - 税负率分析

输出:
  - 增值税复核表
  - 虚假发票清单
  - 税负异常提示

AI能力:
  - 发票真伪识别（OCR+验真）
  - 虚开发票识别
  - 税负异常检测
```

---

### 九、分析节点（Analysis Nodes）

```yaml
# 1. 舞弊风险评分节点
FraudRiskScore:
  - 关联方交易识别
  - 异常模式检测
  - 舞弊风险评分

# 2. 财务比率分析节点
FinancialRatioAnalysis:
  - 偿债能力分析
  - 盈利能力分析
  - 营运能力分析
  - 同行业对比

# 3. 趋势分析节点
TrendAnalysis:
  - 收入成本趋势
  - 利润率趋势
  - 现金流趋势

# 4. 异常交易检测节点
AnomalyDetection:
  - 大额交易识别
  - 频繁交易识别
  - 时间异常识别
```

---

### 十、输出节点（Output Nodes）

```yaml
# 1. 底稿生成节点
WorkpaperGenerate:
  - 自动生成审计底稿
  - 格式化输出
  - 底稿归档

# 2. 报告生成节点
ReportGenerate:
  - 审计报告生成
  - 管理建议书生成
  - 风险提示报告

# 3. 数据导出节点
DataExport:
  - Excel导出
  - PDF导出
  - 数据库导出

# 4. 问题汇总节点
IssueSummary:
  - 问题清单汇总
  - 风险等级分类
  - 责任人分配
```

---

## 🔄 工作流示例

### 示例1: 资产盘点工作流

```
[Excel导入：固定资产明细表]
        ↓
[固定资产盘点节点]
  ├→ 导入资产账
  ├→ 记录盘点结果
  ├→ AI识别资产编号（照片）
  ├→ 账实核对
  └→ 差异分析
        ↓
[异常检测节点]
  └→ 识别大额差异
        ↓
[底稿生成节点]
  └→ 生成盘点底稿
        ↓
[报告生成节点]
  └→ 盘点报告
```

### 示例2: 工资核对工作流

```
[Excel导入：工资表]
        ↓
[工资表核对节点]
  ├→ 工资计算重算
  ├→ 个税验证
  ├→ 社保基数检查
  └→ 异常工资识别（AI）
        ↓
[人员花名册核对节点]
  ├→ 人员真实性验证
  └→ 虚假员工识别（AI）
        ↓
[舞弊风险评分节点]
  └→ 工资舞弊风险评分
        ↓
[底稿生成节点]
  └→ 工资循环底稿
```

### 示例3: 银行对账工作流

```
[Excel导入：银行日记账]
        ↓
[Excel导入：银行对账单]
        ↓
[银行对账单核对节点]
  ├→ 自动对账（AI）
  ├→ 生成余额调节表
  ├→ 未达账项分析
  └→ 异常交易识别（AI）
        ↓
[资金流水分析节点]
  ├→ 大额资金检查
  ├→ 资金流向分析
  └→ 洗钱风险检测（AI）
        ↓
[底稿生成节点]
  └→ 现金循环底稿
```

---

## 👥 人员分工示例

```
审计项目组：
├─ 项目经理（PM）
│  └─ 负责整体协调
│
├─ 资产循环审计师
│  ├─ 固定资产盘点
│  └─ 存货盘点
│
├─ 采购循环审计师
│  ├─ 采购订单核查
│  └─ 应付账款确认
│
├─ 销售循环审计师
│  ├─ 销售收入确认
│  └─ 应收账款函证
│
├─ 工资循环审计师
│  ├─ 工资表核对
│  └─ 人员花名册核对
│
├─ 现金循环审计师
│  ├─ 库存现金盘点
│  └─ 银行对账单核对
│
└─ 税务循环审计师
   ├─ 增值税核算
   └─ 发票真伪验证
```

---

## 📊 节点开发优先级

### Week 2-3: 核心循环节点（必须）

```
优先级P0（8个核心节点）：
1. FixedAssetInventory - 固定资产盘点
2. InventoryCount - 存货盘点
3. PayrollReconciliation - 工资表核对
4. CashCount - 库存现金盘点
5. BankReconciliation - 银行对账
6. RevenueRecognition - 收入确认
7. AccountsPayableConfirm - 应付账款确认
8. VATReconciliation - 增值税核算

工作量：80h
```

### Week 4-5: 扩展节点（建议）

```
优先级P1（6个扩展节点）：
1. PurchaseOrderReview - 采购订单核查
2. AccountsReceivableConfirm - 应收账款函证
3. EmployeeRosterVerify - 人员花名册核对
4. FraudRiskScore - 舞弊风险评分
5. AnomalyDetection - 异常交易检测
6. FinancialRatioAnalysis - 财务比率分析

工作量：48h
```

---

## 🎯 节点标准化设计

每个审计节点都包含：

```typescript
interface AuditNode {
  // 基础信息
  id: string;
  name: string;
  cycle: 'asset' | 'procurement' | 'sales' | 'payroll' | 'cash' | 'cost' | 'tax';
  category: '盘点' | '核对' | '分析' | '验证';
  
  // 输入定义
  inputs: {
    name: string;
    type: 'excel' | 'csv' | 'pdf' | 'image' | 'manual';
    required: boolean;
    description: string;
  }[];
  
  // 处理逻辑
  process: (inputs: any) => Promise<any>;
  
  // 输出定义
  outputs: {
    name: string;
    type: 'data' | 'report' | 'workpaper';
    format: 'json' | 'excel' | 'pdf';
  }[];
  
  // AI能力
  aiCapabilities?: {
    ocr?: boolean;           // OCR识别
    nlp?: boolean;           // 自然语言处理
    fraud?: boolean;         // 舞弊检测
    anomaly?: boolean;       // 异常检测
    prediction?: boolean;    // 预测分析
  };
  
  // 审计底稿
  workpaper: {
    template: string;        // 底稿模板
    fields: string[];        // 必填字段
    format: 'excel' | 'word' | 'pdf';
  };
}
```

---

## 📝 总结

### 核心改进

1. **贴近实际业务**：按照真实审计循环设计，不是泛泛的"审计节点"
2. **清晰的分工**：不同人负责不同循环，职责明确
3. **标准化流程**：每个循环都有标准的审计程序
4. **AI智能增强**：在关键环节使用AI提升效率
5. **底稿自动生成**：每个节点都能生成规范的审计底稿

### 下一步

1. Week 2-3开发8个核心节点
2. 每个节点都要有真实的审计逻辑
3. AI能力作为增强，不是必须
4. 优先保证基础功能可用

---

**文档版本**: v2.0  
**创建日期**: 2025-12-03  
**更新说明**: 根据实际审计业务循环重新设计
