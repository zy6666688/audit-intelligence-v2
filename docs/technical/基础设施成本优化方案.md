# 💰 基础设施成本优化方案

**版本**: v2.0 - 最低成本方案  
**更新日期**: 2025-12-03  
**优化目标**: 降低80%基础设施成本

---

## 🎯 调整原则

1. **微信端使用微信云服务**（腾讯云托管）
2. **服务器选择最低成本方案**
3. **优先使用免费服务**
4. **按需付费，避免包年**

---

## 📊 原方案 vs 优化方案对比

| 项目 | 原方案 | 优化方案 | 节省 |
|------|--------|---------|------|
| **微信小程序服务器** | 阿里云ECS ¥200/月 | 微信云托管 ¥0-50/月 | ¥150/月 |
| **H5服务器** | 独立服务器 ¥200/月 | 腾讯云学生机 ¥10/月 | ¥190/月 |
| **数据库** | RDS ¥100/月 | 云开发数据库 ¥0-30/月 | ¥70/月 |
| **Redis** | 独立实例 ¥60/月 | 内存数据库 ¥0-20/月 | ¥40/月 |
| **CDN** | 阿里云CDN ¥50/月 | 腾讯云免费额度 ¥0/月 | ¥50/月 |
| **对象存储** | OSS ¥30/月 | 云开发存储 ¥0-10/月 | ¥20/月 |
| **SSL证书** | 付费证书 ¥500/年 | Let's Encrypt免费 ¥0 | ¥500/年 |
| **AI服务** | 百度AI ¥5000/月 | 通义千问免费 ¥0 | ¥5000/月 |
| **合计** | **¥640/月** | **¥70-120/月** | **¥520-570/月** |
| **年度成本** | **¥7,680** | **¥840-1,440** | **节省81-89%** |

---

## 🔧 优化方案详细设计

### 一、微信小程序 - 使用微信云托管 ⭐

**方案**: 腾讯云·微信云托管

```yaml
服务: 微信云托管
提供商: 腾讯云
链接: https://cloud.weixin.qq.com/cloudrun

优势:
  ✅ 与微信生态深度集成
  ✅ 自动弹性伸缩
  ✅ 按量计费（用多少付多少）
  ✅ 免费额度充足
  ✅ 无需备案
  ✅ 内网互通，速度快

免费额度（每月）:
  - CPU: 18,000 核秒
  - 内存: 36,000 MB秒
  - 流量: 1 GB
  - 构建次数: 400次

预计费用:
  - 小规模使用: ¥0-20/月
  - 中规模使用: ¥30-50/月
  - 大规模使用: ¥50-100/月

配置建议:
  规格: 0.25核 256MB
  实例数: 0-2（自动伸缩）
  计费方式: 按量计费

部署方式:
  1. 使用微信开发者工具
  2. 一键部署到云托管
  3. 自动构建和发布
```

**申请步骤**:
```bash
Day 3任务：
1. 访问：https://cloud.weixin.qq.com/
2. 登录微信小程序账号
3. 开通"微信云托管"
4. 创建服务
5. 配置构建规则
6. 绑定小程序

工作量：2h
费用：¥0（免费额度）
```

---

### 二、H5服务器 - 腾讯云学生机 ⭐

**方案**: 腾讯云学生优惠

```yaml
服务: 云服务器 CVM
提供商: 腾讯云
链接: https://cloud.tencent.com/act/campus

配置:
  CPU: 1核
  内存: 2GB
  带宽: 1Mbps
  硬盘: 50GB SSD
  系统: Ubuntu 22.04

价格:
  学生价: ¥10/月
  普通价: ¥30-50/月（新用户优惠）

适用场景:
  ✅ H5前端托管
  ✅ Nginx反向代理
  ✅ 轻量级后端
  ✅ 开发测试环境

如果不符合学生资格:
  备选1: 腾讯云轻量应用服务器 ¥50/月
  备选2: 阿里云突发性能实例 ¥30/月
  备选3: 华为云弹性云服务器 ¥40/月
```

---

### 三、数据库 - 使用微信云开发数据库

**方案**: 微信云开发数据库

```yaml
服务: 云开发数据库（MongoDB）
提供商: 腾讯云（微信云开发）

优势:
  ✅ 与云托管内网互通
  ✅ 免费额度充足
  ✅ 自动备份
  ✅ 无需运维

免费额度（每月）:
  - 读操作: 5万次
  - 写操作: 3万次
  - 存储: 2GB
  - 备份: 1GB

预计费用:
  - 开发阶段: ¥0/月
  - 生产小规模: ¥10-30/月
  - 生产中规模: ¥30-60/月

备注:
  如果需要PostgreSQL，可使用腾讯云轻量数据库
  价格: ¥30/月（1核1GB）
```

---

### 四、Redis缓存 - 使用云开发内存数据库

**方案**: 微信云开发 Redis

```yaml
服务: 云开发 Redis
提供商: 腾讯云

配置:
  容量: 256MB
  版本: Redis 5.0

价格:
  免费额度: 256MB
  超出后: ¥0.3/GB/天

预计费用:
  - 小规模: ¥0/月（在免费额度内）
  - 中规模: ¥10-20/月
```

---

### 五、CDN - 使用腾讯云免费额度

**方案**: 腾讯云CDN

```yaml
服务: 内容分发网络 CDN
提供商: 腾讯云

免费额度（新用户6个月）:
  - 流量: 10GB/月
  - HTTPS请求: 100万次/月

价格（超出后）:
  - 国内流量: ¥0.21/GB
  - HTTPS请求: ¥0.05/万次

预计费用:
  - 前6个月: ¥0/月
  - 之后小规模: ¥5-15/月
```

---

### 六、对象存储 - 使用云开发存储

**方案**: 微信云开发存储

```yaml
服务: 云存储
提供商: 腾讯云（微信云开发）

免费额度（每月）:
  - 存储容量: 5GB
  - 下载流量: 10GB
  - 上传流量: 无限
  - CDN回源流量: 10GB

价格（超出后）:
  - 存储: ¥0.004/GB/天
  - 流量: ¥0.15/GB

预计费用:
  - 开发阶段: ¥0/月
  - 生产小规模: ¥5-10/月
```

---

### 七、SSL证书 - 使用Let's Encrypt免费证书

**方案**: Let's Encrypt + 自动续期

```yaml
服务: 免费SSL证书
提供商: Let's Encrypt

优势:
  ✅ 完全免费
  ✅ 自动续期
  ✅ 浏览器信任
  ✅ 支持通配符证书

配置方式:
  使用 certbot 自动申请和续期

申请命令:
  sudo certbot --nginx -d yourdomain.com

自动续期:
  crontab: 0 0 * * * certbot renew

费用: ¥0
```

---

### 八、AI服务 - 使用通义千问免费服务

**方案**: 阿里云通义千问（已确定）

```yaml
服务: 通义千问 API
提供商: 阿里云

优势:
  ✅ 限时免费
  ✅ 性能优秀
  ✅ 申请快速

费用: ¥0（限时免费）
```

---

## 📅 Week 0 基础设施申请清单

### Day 1 (Monday)
```
□ 申请通义千问API（已在Task 5）
  费用：¥0
```

### Day 2 (Tuesday)
```
□ 申请Let's Encrypt SSL证书
  费用：¥0
  工作量：1h
```

### Day 3 (Wednesday) 🔥 关键日
```
□ 开通微信云托管（小程序服务器）
  访问：https://cloud.weixin.qq.com/
  费用：¥0-20/月
  工作量：2h

□ 购买腾讯云学生机（H5服务器）
  访问：https://cloud.tencent.com/act/campus
  费用：¥10/月
  工作量：1h

□ 开通云开发数据库
  费用：¥0-30/月
  工作量：0.5h

□ 开通云开发Redis
  费用：¥0-20/月
  工作量：0.5h

□ 开通云开发存储
  费用：¥0-10/月
  工作量：0.5h

Day 3总计：¥10-80/月
```

### Day 4 (Thursday)
```
□ 配置腾讯云CDN
  费用：¥0（6个月免费）
  工作量：1h
```

---

## 💰 成本汇总

### 月度成本

```
基础设施（月度）:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
微信云托管         ¥0-20
H5服务器（学生机）  ¥10
云开发数据库        ¥0-30
云开发Redis         ¥0-20
云开发存储          ¥0-10
CDN（6个月后）      ¥0-15
SSL证书            ¥0
通义千问API        ¥0
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
总计：             ¥10-95/月

平均月成本：¥50/月
```

### 年度成本

```
第一年（含优惠）:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
前6个月（CDN免费）  ¥300-480
后6个月             ¥360-600
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
总计：             ¥660-1,080/年

平均年成本：¥870/年
相比原方案节省：¥6,810（89%）
```

---

## 🎯 Week 0 执行计划更新

### 更新的 T0003 任务

```yaml
任务ID: T0003
任务名称: 采购基础设施服务
优先级: P0（必须完成）
截止日期: Day 3
工作量: 5h
负责人: OPS + PM

执行步骤：

Step 1: 开通微信云托管（2h）
1. 访问 https://cloud.weixin.qq.com/
2. 使用小程序管理员账号登录
3. 开通"微信云托管"服务
4. 创建服务："审计数智析-生产"
5. 配置规格：0.25核256MB，按量计费
6. 记录服务信息

Step 2: 购买腾讯云学生机（1h）
1. 访问 https://cloud.tencent.com/act/campus
2. 学生认证（需学生证/学信网）
3. 购买1核2GB服务器，¥10/月
4. 选择地域：广州/上海
5. 安装 Ubuntu 22.04
6. 记录IP和密码

Step 3: 开通云开发数据库（0.5h）
1. 在微信云开发控制台
2. 开通数据库服务
3. 创建数据库："audit-db"
4. 记录连接信息

Step 4: 开通其他云服务（1h）
1. 云开发Redis
2. 云开发存储
3. 腾讯云CDN

Step 5: 配置SSL证书（0.5h）
1. 在服务器上安装 certbot
2. 申请 Let's Encrypt 证书
3. 配置自动续期

完成标志：
✓ 微信云托管已开通
✓ 服务器已购买（IP已记录）
✓ 数据库已开通
✓ Redis已开通
✓ 存储已开通
✓ SSL证书已申请
✓ 所有信息已记录到 .env.production

Day 3总费用：约¥10-50/月
```

---

## 📝 配置信息记录模板

**创建文件**: `infrastructure-config.md`

```markdown
# 基础设施配置信息

## 微信云托管
- 服务名称：审计数智析-生产
- 服务ID：______________
- API地址：______________
- 内网地址：______________

## H5服务器（腾讯云）
- IP地址：______________
- SSH端口：22
- 用户名：ubuntu
- 密码：______________（已加密保存）
- 地域：广州/上海

## 云开发数据库
- 数据库名：audit-db
- 连接串：______________
- 管理控制台：______________

## 云开发Redis
- 实例ID：______________
- 连接地址：______________

## 云开发存储
- 存储桶ID：______________
- CDN加速域名：______________

## SSL证书
- 证书路径：/etc/letsencrypt/live/yourdomain.com/
- 到期日期：______________
- 自动续期：已配置
```

---

## ⚠️ 注意事项

### 学生机资格
```
如果没有学生资格：
- 备选：腾讯云新用户优惠
- 首月¥30/月（1核2GB）
- 后续¥50/月

或者使用：
- 阿里云突发性能实例 t5
- ¥30/月（1核2GB，10-20%基准性能）
```

### 数据库选择
```
如果必须使用PostgreSQL:
- 腾讯云轻量数据库 ¥30/月
- 或自建在服务器上（推荐）

自建PostgreSQL优点：
  ✅ 完全免费
  ✅ 完全可控
  ✅ 性能更好

缺点：
  ❌ 需要自己运维
  ❌ 需要自己备份
```

### 成本控制建议
```
1. 设置费用告警：¥50/月
2. 定期查看账单
3. 及时清理无用资源
4. 合理使用免费额度
5. 避免突发流量
```

---

## 🎯 成本优化效果

### 对比总结

| 指标 | 原方案 | 优化方案 | 改善 |
|------|--------|---------|------|
| 月度成本 | ¥640 | ¥50 | ⬇️ 92% |
| 年度成本 | ¥7,680 | ¥870 | ⬇️ 89% |
| 启动成本 | 高 | 极低 | ⬇️ 95% |
| 运维复杂度 | 高 | 低 | ⬇️ 70% |
| 扩展性 | 中 | 高 | ⬆️ 100% |

### ROI提升

```
原方案：
投入 ¥336,900，年度运营成本 ¥7,680
ROI: 48%

优化方案：
投入 ¥336,900，年度运营成本 ¥870
ROI: 55%

提升: 7个百分点
```

---

## ✅ 执行检查清单

```
Day 3 基础设施采购清单：

□ 微信云托管已开通
□ H5服务器已购买
□ 云开发数据库已开通
□ 云开发Redis已开通
□ 云开发存储已开通
□ CDN已配置
□ SSL证书已申请
□ 所有配置信息已记录
□ 所有服务可正常访问
□ 成本在预算内（¥50/月）

验收标准：
✓ 微信小程序可部署到云托管
✓ H5可访问（HTTPS）
✓ 数据库可连接
✓ Redis可连接
✓ 文件可上传到云存储
```

---

**文档版本**: v2.0  
**创建日期**: 2025-12-03  
**优化目标**: 降低89%成本  
**预计节省**: ¥6,810/年
