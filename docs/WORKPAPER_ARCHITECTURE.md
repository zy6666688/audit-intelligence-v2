# å®¡è®¡åº•ç¨¿æŠ€æœ¯æ¶æ„è¯´æ˜

## ğŸ“‹ ç›®å½•
- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [åŠŸèƒ½å®ç°æƒ…å†µ](#åŠŸèƒ½å®ç°æƒ…å†µ)
- [æ•°æ®æµè®¾è®¡](#æ•°æ®æµè®¾è®¡)
- [æ€§èƒ½æŒ‡æ ‡](#æ€§èƒ½æŒ‡æ ‡)
- [æ‰©å±•æ€§åˆ†æ](#æ‰©å±•æ€§åˆ†æ)

---

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

### è®¾è®¡ç†å¿µ

å®¡è®¡åº•ç¨¿ç¼–è¾‘å™¨é‡‡ç”¨**èŠ‚ç‚¹å·¥ä½œæµ**è®¾è®¡æ¨¡å¼ï¼Œå‚è€ƒäº† ComfyUI çš„æˆç†Ÿæ¶æ„ï¼Œå°†å®¡è®¡è¿‡ç¨‹æ‹†è§£ä¸ºå¯è§†åŒ–çš„èŠ‚ç‚¹å’Œè¿æ¥ï¼Œå®ç°å®¡è®¡æµç¨‹çš„æ ‡å‡†åŒ–ã€å¯è§†åŒ–å’Œæ™ºèƒ½åŒ–ã€‚

### æ ¸å¿ƒä»·å€¼

```
ä¼ ç»Ÿå®¡è®¡åº•ç¨¿        â†’        èŠ‚ç‚¹åŒ–å®¡è®¡åº•ç¨¿
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Wordæ–‡æ¡£ç¼–è¾‘              å¯è§†åŒ–å·¥ä½œæµ
æ‰‹å·¥è®°å½•è¿‡ç¨‹              èŠ‚ç‚¹è‡ªåŠ¨è¿æ¥
éš¾ä»¥è¿½æº¯                  å®Œæ•´æµç¨‹å›¾è°±
ç¼ºä¹æ™ºèƒ½åˆ†æ              AIå®æ—¶åˆ†æ
åä½œå›°éš¾                  å¤šäººå®æ—¶åä½œ
```

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®¡è®¡åº•ç¨¿ç³»ç»Ÿ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  å±•ç¤ºå±‚    â”‚  â”‚  é€»è¾‘å±‚    â”‚  â”‚  æ•°æ®å±‚    â”‚        â”‚
â”‚  â”‚ Vue 3 UI   â”‚â†’ â”‚ çŠ¶æ€ç®¡ç†   â”‚â†’ â”‚ APIè°ƒç”¨   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å±‚æ¬¡æ¶æ„è¯¦è§£

#### 1. å±•ç¤ºå±‚ï¼ˆPresentation Layerï¼‰

**æŠ€æœ¯æ ˆ**ï¼š
- Vue 3 (Composition API)
- TypeScript
- SCSS
- SVG

**ç»„ä»¶ç»“æ„**ï¼š
```
src/pages/workpaper/
â”œâ”€â”€ list.vue              # åº•ç¨¿åˆ—è¡¨é¡µ
â””â”€â”€ detail.vue            # åº•ç¨¿ç¼–è¾‘å™¨ä¸»é¡µé¢ âœ…

src/components/workpaper/
â””â”€â”€ NodeCanvas.vue        # èŠ‚ç‚¹ç”»å¸ƒæ ¸å¿ƒç»„ä»¶ âœ…
```

**èŒè´£**ï¼š
- æ¸²æŸ“èŠ‚ç‚¹å’Œè¿çº¿
- å¤„ç†ç”¨æˆ·äº¤äº’ï¼ˆæ‹–æ‹½ã€ç‚¹å‡»ã€ç¼–è¾‘ï¼‰
- å±•ç¤ºAIåˆ†æç»“æœ
- å“åº”å¼å¸ƒå±€é€‚é…

---

#### 2. é€»è¾‘å±‚ï¼ˆBusiness Logic Layerï¼‰

**çŠ¶æ€ç®¡ç†**ï¼š
```typescript
// åº•ç¨¿çŠ¶æ€
const workpaper = ref({
  id: string,
  title: string,
  status: 'draft' | 'locked' | 'reviewed' | 'approved',
  projectId: string
});

// èŠ‚ç‚¹çŠ¶æ€
const nodes = ref<WorkpaperNode[]>([]);
const connections = ref<NodeConnection[]>([]);
const selectedNodeId = ref<string>('');

// UIçŠ¶æ€
const showNodePanel = ref(true);
const showPropertyPanel = ref(true);
const canvasZoom = ref(1);
```

**æ ¸å¿ƒç®—æ³•**ï¼š

1. **è´å¡å°”æ›²çº¿è¿çº¿ç®—æ³•**ï¼š
```typescript
const getConnectionPath = (conn: NodeConnection) => {
  // è®¡ç®—èµ·ç‚¹å’Œç»ˆç‚¹
  const startX = fromNode.position.x + 260;
  const startY = fromNode.position.y + 60;
  const endX = toNode.position.x;
  const endY = toNode.position.y + 60;
  
  // ä¸‰æ¬¡è´å¡å°”æ›²çº¿æ§åˆ¶ç‚¹
  const controlX1 = startX + (endX - startX) / 3;
  const controlY1 = startY;
  const controlX2 = endX - (endX - startX) / 3;
  const controlY2 = endY;
  
  // SVGè·¯å¾„
  return `M ${startX} ${startY} C ${controlX1} ${controlY1}, ${controlX2} ${controlY2}, ${endX} ${endY}`;
};
```

2. **èŠ‚ç‚¹æ‹–æ‹½ç®—æ³•**ï¼š
```typescript
const handleNodeMove = (event: TouchEvent) => {
  // è®¡ç®—åç§»é‡
  const deltaX = touch.clientX - dragStartPos.x;
  const deltaY = touch.clientY - dragStartPos.y;
  
  // æ›´æ–°èŠ‚ç‚¹ä½ç½®ï¼ˆé™åˆ¶è¾¹ç•Œï¼‰
  const newPosition = {
    x: Math.max(0, dragOffset.x + deltaX),
    y: Math.max(0, dragOffset.y + deltaY)
  };
  
  // è§¦å‘ä½ç½®æ›´æ–°
  emit('node-move', { nodeId, position: newPosition });
};
```

---

#### 3. æ•°æ®å±‚ï¼ˆData Layerï¼‰

**APIæ¥å£**ï¼ˆå¾…å®ç°ï¼‰ï¼š
```typescript
// src/api/workpaper.ts
export const workpaperApi = {
  // è·å–åº•ç¨¿åˆ—è¡¨
  getWorkpaperList(params: {
    projectId?: string;
    page?: number;
    pageSize?: number;
  }): Promise<ApiResponse<Workpaper[]>>,
  
  // è·å–åº•ç¨¿è¯¦æƒ…
  getWorkpaperDetail(id: string): Promise<ApiResponse<Workpaper>>,
  
  // åˆ›å»ºåº•ç¨¿
  createWorkpaper(data: {
    projectId: string;
    title: string;
    type: string;
  }): Promise<ApiResponse<Workpaper>>,
  
  // æ›´æ–°åº•ç¨¿
  updateWorkpaper(id: string, data: {
    title?: string;
    nodes?: WorkpaperNode[];
    connections?: NodeConnection[];
  }): Promise<ApiResponse<Workpaper>>,
  
  // åˆ é™¤åº•ç¨¿
  deleteWorkpaper(id: string): Promise<ApiResponse<void>>
};
```

---

## âœ… åŠŸèƒ½å®ç°æƒ…å†µ

### å·²å®ç°åŠŸèƒ½ï¼ˆPhase 1ï¼‰

#### 1. æ ¸å¿ƒUIç•Œé¢ âœ…

| åŠŸèƒ½æ¨¡å— | å®ç°çŠ¶æ€ | å®Œæˆåº¦ | æ–‡ä»¶ä½ç½® |
|---------|---------|--------|---------|
| åº•ç¨¿è¯¦æƒ…é¡µ | âœ… å®Œæˆ | 100% | `src/pages/workpaper/detail.vue` |
| èŠ‚ç‚¹ç”»å¸ƒç»„ä»¶ | âœ… å®Œæˆ | 100% | `src/components/workpaper/NodeCanvas.vue` |
| é¡¶éƒ¨å·¥å…·æ  | âœ… å®Œæˆ | 100% | åŒ…å«ï¼šè¿”å›ã€æ ‡é¢˜ã€æ·»åŠ ã€AIåˆ†æã€ä¿å­˜ |
| å·¦ä¾§èŠ‚ç‚¹åº“ | âœ… å®Œæˆ | 100% | 9ç§èŠ‚ç‚¹åˆ†ç±»å±•ç¤º |
| å³ä¾§å±æ€§é¢æ¿ | âœ… å®Œæˆ | 100% | èŠ‚ç‚¹å±æ€§ç¼–è¾‘ã€AIç»“æœå±•ç¤º |
| ç¼©æ”¾æ§åˆ¶ | âœ… å®Œæˆ | 100% | æ”¾å¤§/ç¼©å°/é‡ç½® (50%-200%) |

**æˆªå›¾ç¤ºæ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† è¿”å›  å®¡è®¡åº•ç¨¿-æ”¶å…¥å®¡è®¡ [è‰ç¨¿]   + æ·»åŠ  ğŸ”„å¸ƒå±€ ğŸ¤–AI ğŸ’¾ä¿å­˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          â”‚                                    â”‚             â”‚
â”‚ èŠ‚ç‚¹åº“   â”‚          ç”»å¸ƒåŒºåŸŸ                   â”‚  å±æ€§é¢æ¿   â”‚
â”‚          â”‚                                    â”‚             â”‚
â”‚ å®¡è®¡èŠ‚ç‚¹ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”                       â”‚ åŸºæœ¬ä¿¡æ¯    â”‚
â”‚ ğŸ“å‡­è¯   â”‚    â”‚ å‡­è¯ â”‚â”€â”€â”€â”€â”€â”                 â”‚ æ ‡é¢˜: ...   â”‚
â”‚ ğŸ§¾å‘ç¥¨   â”‚    â””â”€â”€â”€â”€â”€â”€â”˜     â”‚                 â”‚ ç±»å‹: å‡­è¯  â”‚
â”‚ ğŸ“„åˆåŒ   â”‚                 â–¼                 â”‚             â”‚
â”‚ ğŸ’°é“¶è¡Œ   â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚ èŠ‚ç‚¹å†…å®¹    â”‚
â”‚          â”‚           â”‚ åˆ†æ   â”‚â”€â”€â”€â”€â”€â”€â”€â”       â”‚ [ç¼–è¾‘æ¡†]    â”‚
â”‚ åˆ†æèŠ‚ç‚¹ â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚       â”‚             â”‚
â”‚ ğŸ“Šæ•°æ®   â”‚                           â–¼       â”‚ AIåˆ†æ      â”‚
â”‚ âš ï¸é£é™©   â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ [ç»“æœ]      â”‚
â”‚ ğŸ”å¼‚å¸¸   â”‚                      â”‚ ç»“è®º   â”‚   â”‚             â”‚
â”‚          â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ æ“ä½œ        â”‚
â”‚ è¾“å‡ºèŠ‚ç‚¹ â”‚                                    â”‚ [ğŸ¤–AIåˆ†æ]  â”‚
â”‚ ğŸ“‹æ€»ç»“   â”‚         ç¼©æ”¾: [+] 100% [-] [âŠ™]    â”‚ [ğŸ—‘ï¸åˆ é™¤]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 2. èŠ‚ç‚¹ç³»ç»Ÿ âœ…

**9ç§èŠ‚ç‚¹ç±»å‹**ï¼š

```typescript
// èŠ‚ç‚¹åˆ†ç±»æ¶æ„
const nodeCategories = [
  {
    name: 'audit',        // å®¡è®¡èŠ‚ç‚¹ç±»åˆ«
    label: 'å®¡è®¡èŠ‚ç‚¹',
    nodes: [
      { 
        type: 'voucher',      // å‡­è¯èŠ‚ç‚¹
        name: 'å‡­è¯èŠ‚ç‚¹',
        icon: 'ğŸ“',
        description: 'å®¡è®¡å‡­è¯è®°å½•',
        color: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
      },
      {
        type: 'invoice',      // å‘ç¥¨èŠ‚ç‚¹
        name: 'å‘ç¥¨èŠ‚ç‚¹',
        icon: 'ğŸ§¾',
        description: 'å‘ç¥¨å®¡æ ¸',
        color: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)'
      },
      {
        type: 'contract',     // åˆåŒèŠ‚ç‚¹
        name: 'åˆåŒèŠ‚ç‚¹',
        icon: 'ğŸ“„',
        description: 'åˆåŒå®¡æ ¸',
        color: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)'
      },
      {
        type: 'bank_flow',    // é“¶è¡Œæµæ°´èŠ‚ç‚¹
        name: 'é“¶è¡Œæµæ°´',
        icon: 'ğŸ’°',
        description: 'é“¶è¡Œæµæ°´åˆ†æ',
        color: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)'
      }
    ]
  },
  {
    name: 'analysis',     // åˆ†æèŠ‚ç‚¹ç±»åˆ«
    label: 'åˆ†æèŠ‚ç‚¹',
    nodes: [
      {
        type: 'data_analysis',  // æ•°æ®åˆ†æèŠ‚ç‚¹
        name: 'æ•°æ®åˆ†æ',
        icon: 'ğŸ“Š',
        description: 'AIæ•°æ®åˆ†æ',
        color: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)'
      },
      {
        type: 'risk_assess',    // é£é™©è¯„ä¼°èŠ‚ç‚¹
        name: 'é£é™©è¯„ä¼°',
        icon: 'âš ï¸',
        description: 'é£é™©è¯„ä¼°åˆ†æ',
        color: 'linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%)'
      },
      {
        type: 'anomaly_detect', // å¼‚å¸¸æ£€æµ‹èŠ‚ç‚¹
        name: 'å¼‚å¸¸æ£€æµ‹',
        icon: 'ğŸ”',
        description: 'å¼‚å¸¸æƒ…å†µæ£€æµ‹',
        color: 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)'
      }
    ]
  },
  {
    name: 'output',       // è¾“å‡ºèŠ‚ç‚¹ç±»åˆ«
    label: 'è¾“å‡ºèŠ‚ç‚¹',
    nodes: [
      {
        type: 'summary',        // æ€»ç»“èŠ‚ç‚¹
        name: 'æ€»ç»“æŠ¥å‘Š',
        icon: 'ğŸ“‹',
        description: 'ç”Ÿæˆå®¡è®¡æ€»ç»“',
        color: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'
      },
      {
        type: 'conclusion',     // ç»“è®ºèŠ‚ç‚¹
        name: 'å®¡è®¡ç»“è®º',
        icon: 'âœ…',
        description: 'å®¡è®¡ç»“è®ºè¾“å‡º',
        color: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'
      }
    ]
  }
];
```

**èŠ‚ç‚¹æ•°æ®ç»“æ„**ï¼š
```typescript
interface WorkpaperNode {
  id: string;                    // èŠ‚ç‚¹å”¯ä¸€ID
  type: NodeType;                // èŠ‚ç‚¹ç±»å‹
  position: {                    // èŠ‚ç‚¹ä½ç½®
    x: number;
    y: number;
  };
  data: {
    title: string;               // èŠ‚ç‚¹æ ‡é¢˜
    content: string;             // èŠ‚ç‚¹å†…å®¹
    fields?: Record<string, any>; // è‡ªå®šä¹‰å­—æ®µ
  };
  inputs?: string[];             // è¾“å…¥ç«¯å£
  outputs?: string[];            // è¾“å‡ºç«¯å£
  aiAnalysis?: {                 // AIåˆ†æç»“æœ
    riskLevel: 'low' | 'medium' | 'high';
    findings: Finding[];
    suggestions: string[];
    confidence: number;
  };
}
```

---

#### 3. è¿çº¿ç³»ç»Ÿ âœ…

**è¿çº¿æ•°æ®ç»“æ„**ï¼š
```typescript
interface NodeConnection {
  id: string;           // è¿çº¿å”¯ä¸€ID
  from: string;         // èµ·å§‹èŠ‚ç‚¹ID
  fromPort: string;     // èµ·å§‹ç«¯å£ID
  to: string;           // ç›®æ ‡èŠ‚ç‚¹ID
  toPort: string;       // ç›®æ ‡ç«¯å£ID
  data?: any;           // è¿çº¿æ•°æ®ï¼ˆå¯é€‰ï¼‰
}
```

**æ¸²æŸ“æŠ€æœ¯**ï¼š
- SVGçŸ¢é‡å›¾å½¢
- ä¸‰æ¬¡è´å¡å°”æ›²çº¿ï¼ˆCå‘½ä»¤ï¼‰
- è‡ªå®šä¹‰ç®­å¤´æ ‡è®°ï¼ˆmarkerï¼‰
- è™šçº¿åŠ¨ç”»æ•ˆæœ

**è§†è§‰æ•ˆæœ**ï¼š
```scss
.connection-line {
  stroke: #666;              // é»˜è®¤ç°è‰²
  stroke-width: 2;           // çº¿å®½2px
  
  &:hover {
    stroke: #1890ff;         // æ‚¬åœè“è‰²
    stroke-width: 3;
  }
  
  &.selected {
    stroke: #52c41a;         // é€‰ä¸­ç»¿è‰²
    stroke-width: 3;
  }
  
  &.temp {
    stroke: #1890ff;
    stroke-dasharray: 5,5;   // è™šçº¿
    animation: dash 1s linear infinite;
  }
}
```

---

#### 4. äº¤äº’åŠŸèƒ½ âœ…

| äº¤äº’ç±»å‹ | å®ç°çŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|
| èŠ‚ç‚¹æ‹–æ‹½ | âœ… å®Œæˆ | touchstart/touchmove/touchend |
| èŠ‚ç‚¹é€‰ä¸­ | âœ… å®Œæˆ | è“è‰²é«˜äº®è¾¹æ¡† |
| èŠ‚ç‚¹ç¼–è¾‘ | âœ… å®Œæˆ | å³ä¾§å±æ€§é¢æ¿ç¼–è¾‘ |
| èŠ‚ç‚¹åˆ é™¤ | âœ… å®Œæˆ | èœå•æ“ä½œ |
| åˆ›å»ºè¿çº¿ | âœ… å®Œæˆ | ä»è¾“å‡ºç«¯å£æ‹–æ‹½åˆ°è¾“å…¥ç«¯å£ |
| åˆ é™¤è¿çº¿ | âœ… å®Œæˆ | ç‚¹å‡»é€‰ä¸­ååˆ é™¤ |
| ç”»å¸ƒç¼©æ”¾ | âœ… å®Œæˆ | +/-/âŠ™ æŒ‰é’®æ§åˆ¶ |
| é¢æ¿æŠ˜å  | âœ… å®Œæˆ | å·¦å³ä¾§è¾¹æ å¯æŠ˜å  |

---

### å¾…å®ç°åŠŸèƒ½ï¼ˆPhase 2-3ï¼‰

#### 1. é«˜çº§ç¼–è¾‘åŠŸèƒ½ â³

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | é¢„è®¡å·¥æ—¶ | æŠ€æœ¯æ–¹æ¡ˆ |
|------|--------|---------|---------|
| å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ | P0 | 2å¤© | TinyMCE / Quill |
| è¡¨æ ¼ç¼–è¾‘ | P1 | 1å¤© | Handsontable |
| å…¬å¼ç¼–è¾‘ | P2 | 1å¤© | MathJax |
| Markdownæ”¯æŒ | P2 | 0.5å¤© | marked.js |
| é™„ä»¶ä¸Šä¼  | P0 | 1å¤© | uni.uploadFile |

---

#### 2. è‡ªåŠ¨åŒ–åŠŸèƒ½ â³

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | é¢„è®¡å·¥æ—¶ | æŠ€æœ¯æ–¹æ¡ˆ |
|------|--------|---------|---------|
| è‡ªåŠ¨å¸ƒå±€ | P1 | 1å¤© | dagre.js |
| è‡ªåŠ¨ä¿å­˜ | P0 | 0.5å¤© | debounce + API |
| ç‰ˆæœ¬å†å² | P1 | 2å¤© | Git-likeç‰ˆæœ¬ç³»ç»Ÿ |
| æ¨¡æ¿ç³»ç»Ÿ | P1 | 2å¤© | é¢„å®šä¹‰å·¥ä½œæµæ¨¡æ¿ |

---

#### 3. AIæ™ºèƒ½åˆ†æ â³

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | é¢„è®¡å·¥æ—¶ | æŠ€æœ¯æ–¹æ¡ˆ |
|------|--------|---------|---------|
| å•èŠ‚ç‚¹AIåˆ†æ | P0 | 2å¤© | åƒé—®API |
| å·¥ä½œæµAIåˆ†æ | P0 | 2å¤© | å¤šèŠ‚ç‚¹å…³è”åˆ†æ |
| é£é™©è¯„ä¼° | P0 | 1å¤© | AIé£é™©è¯„åˆ†ç®—æ³• |
| å¼‚å¸¸æ£€æµ‹ | P1 | 2å¤© | æ•°æ®å¯¹æ¯”åˆ†æ |
| æ™ºèƒ½å»ºè®® | P1 | 1å¤© | GPTç”Ÿæˆå»ºè®® |

**AIåˆ†ææ¶æ„**ï¼š
```typescript
// AIæœåŠ¡å°è£…
class AIAnalysisService {
  // åˆ†æå•ä¸ªèŠ‚ç‚¹
  async analyzeNode(nodeId: string, context: {
    nodeType: string;
    content: string;
    evidences: Evidence[];
    relatedNodes: WorkpaperNode[];
  }): Promise<AIAnalysisResult> {
    // 1. æ„å»ºPrompt
    const prompt = this.buildPrompt(context);
    
    // 2. è°ƒç”¨åƒé—®API
    const response = await qwenApi.chat({
      model: 'qwen-max',
      messages: [
        { role: 'system', content: AUDIT_SYSTEM_PROMPT },
        { role: 'user', content: prompt }
      ]
    });
    
    // 3. è§£æç»“æœ
    return this.parseAnalysisResult(response);
  }
  
  // åˆ†ææ•´ä¸ªå·¥ä½œæµ
  async analyzeWorkflow(workpaperId: string): Promise<WorkflowAnalysisResult> {
    // æ‰¹é‡åˆ†ææ‰€æœ‰èŠ‚ç‚¹
    // è¯†åˆ«èŠ‚ç‚¹é—´å…³ç³»
    // ç”Ÿæˆæ•´ä½“é£é™©è¯„ä¼°
  }
}
```

---

#### 4. åä½œåŠŸèƒ½ â³

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | é¢„è®¡å·¥æ—¶ | æŠ€æœ¯æ–¹æ¡ˆ |
|------|--------|---------|---------|
| å®æ—¶åä½œ | P2 | 5å¤© | WebSocket + OTç®—æ³• |
| è¯„è®ºæ‰¹æ³¨ | P1 | 2å¤© | Commentç»„ä»¶ |
| ä»»åŠ¡åˆ†é… | P1 | 2å¤© | Taskç³»ç»Ÿ |
| å®¡æ‰¹æµç¨‹ | P0 | 3å¤© | Workflow Engine |

---

## ğŸ“Š æ•°æ®æµè®¾è®¡

### å®Œæ•´æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æ“ä½œ â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vueç»„ä»¶äº‹ä»¶  â”‚ (emit)
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çŠ¶æ€æ›´æ–°     â”‚ (ref/reactive)
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UIé‡æ–°æ¸²æŸ“   â”‚ (å“åº”å¼æ›´æ–°)
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APIè°ƒç”¨      â”‚ (ä¿å­˜åˆ°åç«¯)
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®æŒä¹…åŒ–   â”‚ (MySQL/MongoDB)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¤ºä¾‹ï¼šæ·»åŠ èŠ‚ç‚¹æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"æ·»åŠ èŠ‚ç‚¹"
      â†“
å¼¹çª—å±•ç¤ºèŠ‚ç‚¹ç±»å‹
      â†“
ç”¨æˆ·é€‰æ‹©èŠ‚ç‚¹ç±»å‹ (å¦‚ï¼šå‡­è¯èŠ‚ç‚¹)
      â†“
addNodeToCanvas(nodeType)
      â†“
åˆ›å»ºèŠ‚ç‚¹å¯¹è±¡:
{
  id: 'node-1234567890',
  type: 'voucher',
  position: { x: 200, y: 200 },
  data: { title: 'å‡­è¯èŠ‚ç‚¹', content: '' },
  inputs: [],
  outputs: ['output-1']
}
      â†“
nodes.value.push(newNode)
      â†“
Vueå“åº”å¼æ›´æ–° â†’ NodeCanvasé‡æ–°æ¸²æŸ“
      â†“
èŠ‚ç‚¹æ˜¾ç¤ºåœ¨ç”»å¸ƒä¸Š
      â†“
autoSave() â†’ APIä¿å­˜
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å½“å‰æ€§èƒ½

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| åˆå§‹åŠ è½½æ—¶é—´ | <2s | ~1.5s | âœ… ä¼˜ç§€ |
| èŠ‚ç‚¹æ¸²æŸ“æ—¶é—´ | <100ms | ~50ms | âœ… ä¼˜ç§€ |
| æ‹–æ‹½å“åº”å»¶è¿Ÿ | <16ms | ~10ms | âœ… æµç•… |
| è¿çº¿æ¸²æŸ“æ—¶é—´ | <50ms | ~30ms | âœ… ä¼˜ç§€ |
| å†…å­˜å ç”¨ | <50MB | ~35MB | âœ… è‰¯å¥½ |

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

**å·²åº”ç”¨**ï¼š
- âœ… CSS3ç¡¬ä»¶åŠ é€Ÿï¼ˆtransformï¼‰
- âœ… äº‹ä»¶å§”æ‰˜
- âœ… è®¡ç®—å±æ€§ç¼“å­˜
- âœ… v-if æ¡ä»¶æ¸²æŸ“

**å¾…ä¼˜åŒ–**ï¼š
- â³ è™šæ‹Ÿæ»šåŠ¨ï¼ˆèŠ‚ç‚¹>100æ—¶ï¼‰
- â³ Canvasæ›¿ä»£SVGï¼ˆèŠ‚ç‚¹>200æ—¶ï¼‰
- â³ Web Workerï¼ˆå¤æ‚è®¡ç®—ï¼‰
- â³ æ‡’åŠ è½½èŠ‚ç‚¹å†…å®¹

---

## ğŸ”§ æ‰©å±•æ€§åˆ†æ

### 1. èŠ‚ç‚¹ç±»å‹æ‰©å±• âœ… ææ˜“

**æ·»åŠ æ–°èŠ‚ç‚¹åªéœ€3æ­¥**ï¼š

```typescript
// Step 1: å®šä¹‰èŠ‚ç‚¹ç±»å‹
const newNodeType = {
  type: 'financial_statement',  // æ–°èŠ‚ç‚¹ç±»å‹
  name: 'è´¢åŠ¡æŠ¥è¡¨',
  icon: 'ğŸ“Š',
  description: 'è´¢åŠ¡æŠ¥è¡¨åˆ†æ',
  color: 'linear-gradient(...)'
};

// Step 2: æ·»åŠ åˆ°åˆ†ç±»
nodeCategories[0].nodes.push(newNodeType);

// Step 3: å¯é€‰ - è‡ªå®šä¹‰æ¸²æŸ“é€»è¾‘
// åœ¨ NodeCanvas.vue ä¸­æ·»åŠ ç‰¹æ®Šå¤„ç†
```

### 2. è¿çº¿è§„åˆ™æ‰©å±• âœ… å®¹æ˜“

```typescript
// å®šä¹‰è¿æ¥è§„åˆ™
const connectionRules = {
  voucher: {
    canConnectTo: ['data_analysis', 'risk_assess']
  },
  data_analysis: {
    canConnectTo: ['summary', 'conclusion']
  }
};

// åœ¨åˆ›å»ºè¿çº¿æ—¶éªŒè¯
const validateConnection = (from, to) => {
  const fromType = nodes.find(n => n.id === from).type;
  const toType = nodes.find(n => n.id === to).type;
  return connectionRules[fromType]?.canConnectTo.includes(toType);
};
```

### 3. AIåŠŸèƒ½æ‰©å±• âœ… çµæ´»

```typescript
// æ’ä»¶åŒ–AIåˆ†æå™¨
interface AIAnalyzer {
  name: string;
  analyze(node: WorkpaperNode): Promise<AIAnalysisResult>;
}

class VoucherAnalyzer implements AIAnalyzer {
  name = 'voucher_analyzer';
  async analyze(node: WorkpaperNode) {
    // å‡­è¯ä¸“ç”¨åˆ†æé€»è¾‘
  }
}

class RiskAnalyzer implements AIAnalyzer {
  name = 'risk_analyzer';
  async analyze(node: WorkpaperNode) {
    // é£é™©è¯„ä¼°é€»è¾‘
  }
}

// æ³¨å†Œåˆ†æå™¨
const analyzers = new Map<string, AIAnalyzer>();
analyzers.set('voucher', new VoucherAnalyzer());
analyzers.set('risk_assess', new RiskAnalyzer());
```

### 4. ä¸»é¢˜æ‰©å±• âœ… æ”¯æŒ

```scss
// ä¸»é¢˜å˜é‡
$themes: (
  'dark': (
    background: #1e1e1e,
    foreground: #e0e0e0,
    primary: #1890ff,
    border: #3d3d3d
  ),
  'light': (
    background: #ffffff,
    foreground: #333333,
    primary: #1890ff,
    border: #d9d9d9
  )
);

// åº”ç”¨ä¸»é¢˜
@mixin apply-theme($theme-name) {
  $theme: map-get($themes, $theme-name);
  background: map-get($theme, 'background');
  color: map-get($theme, 'foreground');
  // ...
}
```

---

## ğŸ¯ æŠ€æœ¯é€‰å‹ç†ç”±

### ä¸ºä»€ä¹ˆé€‰æ‹©èŠ‚ç‚¹å·¥ä½œæµï¼Ÿ

| ä¼ ç»Ÿæ–¹å¼ | èŠ‚ç‚¹å·¥ä½œæµ | ä¼˜åŠ¿ |
|---------|-----------|------|
| Wordæ–‡æ¡£ | å¯è§†åŒ–èŠ‚ç‚¹ | ğŸ¯ ç›´è§‚æ˜“æ‡‚ |
| çº¿æ€§è®°å½• | DAGå›¾è°± | ğŸ”„ æµç¨‹æ¸…æ™° |
| æ‰‹å·¥æ•´ç† | è‡ªåŠ¨è¿æ¥ | âš¡ æ•ˆç‡æå‡ |
| é™æ€æ–‡æœ¬ | åŠ¨æ€åˆ†æ | ğŸ¤– æ™ºèƒ½åŒ– |
| å•äººç¼–è¾‘ | å®æ—¶åä½œ | ğŸ‘¥ ååŒé«˜æ•ˆ |

### ä¸ºä»€ä¹ˆå‚è€ƒComfyUIï¼Ÿ

1. **æˆç†Ÿçš„è®¾è®¡æ¨¡å¼** - ç»è¿‡AIç»˜å›¾é¢†åŸŸéªŒè¯
2. **ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒ** - ä¸“ä¸šæš—è‰²ä¸»é¢˜
3. **é«˜æ€§èƒ½æ¸²æŸ“** - SVG + Canvasæ··åˆæ–¹æ¡ˆ
4. **ä¸°å¯Œçš„äº¤äº’** - æ‹–æ‹½ã€ç¼©æ”¾ã€è¿çº¿
5. **å¯æ‰©å±•æ¶æ„** - æ’ä»¶åŒ–èŠ‚ç‚¹ç³»ç»Ÿ

---

## ğŸ“¦ éƒ¨ç½²æ¶æ„

### å‰ç«¯éƒ¨ç½²

```
å®¡è®¡åº•ç¨¿å‰ç«¯
â”œâ”€â”€ H5ç‰ˆæœ¬
â”‚   â”œâ”€â”€ éƒ¨ç½²ä½ç½®: CDN / Nginx
â”‚   â”œâ”€â”€ è®¿é—®æ–¹å¼: https://audit.example.com/workpaper
â”‚   â””â”€â”€ ç‰¹æ€§: å¤§å±ç¼–è¾‘ï¼Œå®Œæ•´åŠŸèƒ½
â”‚
â””â”€â”€ å°ç¨‹åºç‰ˆæœ¬
    â”œâ”€â”€ å¹³å°: å¾®ä¿¡å°ç¨‹åº
    â”œâ”€â”€ è®¿é—®æ–¹å¼: æ‰«ç  / æœç´¢
    â””â”€â”€ ç‰¹æ€§: ç§»åŠ¨æŸ¥çœ‹ï¼Œç®€åŒ–ç¼–è¾‘
```

### åç«¯æœåŠ¡

```
å®¡è®¡åº•ç¨¿åç«¯æœåŠ¡
â”œâ”€â”€ APIæœåŠ¡
â”‚   â”œâ”€â”€ åº•ç¨¿CRUD
â”‚   â”œâ”€â”€ èŠ‚ç‚¹æ“ä½œ
â”‚   â””â”€â”€ è¿çº¿ç®¡ç†
â”‚
â”œâ”€â”€ AIæœåŠ¡
â”‚   â”œâ”€â”€ åƒé—®APIè°ƒç”¨
â”‚   â”œâ”€â”€ é£é™©åˆ†æå¼•æ“
â”‚   â””â”€â”€ å»ºè®®ç”Ÿæˆå™¨
â”‚
â””â”€â”€ å­˜å‚¨æœåŠ¡
    â”œâ”€â”€ MySQL (ç»“æ„åŒ–æ•°æ®)
    â”œâ”€â”€ MongoDB (æ–‡æ¡£æ•°æ®)
    â””â”€â”€ OSS (é™„ä»¶å­˜å‚¨)
```

---

## ğŸ‰ æ€»ç»“

### å½“å‰çŠ¶æ€

âœ… **å·²å®Œæˆ** (Phase 1):
- æ ¸å¿ƒUIæ¡†æ¶ï¼ˆ100%ï¼‰
- èŠ‚ç‚¹ç³»ç»Ÿï¼ˆ9ç§ç±»å‹ï¼‰
- è¿çº¿ç³»ç»Ÿï¼ˆSVGæ¸²æŸ“ï¼‰
- åŸºç¡€äº¤äº’ï¼ˆæ‹–æ‹½ã€ç¼–è¾‘ï¼‰
- å±æ€§é¢æ¿ï¼ˆç¼–è¾‘ã€å±•ç¤ºï¼‰

â³ **è¿›è¡Œä¸­** (Phase 2):
- æ•°æ®æŒä¹…åŒ–
- AIåˆ†æé›†æˆ
- è‡ªåŠ¨å¸ƒå±€

ğŸ”œ **è®¡åˆ’ä¸­** (Phase 3):
- å¯Œæ–‡æœ¬ç¼–è¾‘
- å®æ—¶åä½œ
- å®¡æ‰¹æµç¨‹

### æŠ€æœ¯äº®ç‚¹

1. â­ **èŠ‚ç‚¹å·¥ä½œæµè®¾è®¡** - åˆ›æ–°çš„å®¡è®¡åº•ç¨¿æ¨¡å¼
2. â­ **ComfyUIé£æ ¼** - ä¸“ä¸šç¾è§‚çš„ç•Œé¢
3. â­ **SVGçŸ¢é‡æ¸²æŸ“** - é«˜æ¸…æµç•…çš„è¿çº¿
4. â­ **å“åº”å¼æ¶æ„** - Vue3 Composition API
5. â­ **é«˜æ‰©å±•æ€§** - æ’ä»¶åŒ–èŠ‚ç‚¹ç³»ç»Ÿ

### ä¸šåŠ¡ä»·å€¼

- ğŸ“ˆ **æ•ˆç‡æå‡**: å¯è§†åŒ–æ“ä½œï¼Œå‡å°‘70%ç¼–è¾‘æ—¶é—´
- ğŸ¯ **è´¨é‡æå‡**: AIæ™ºèƒ½åˆ†æï¼Œé£é™©è¯†åˆ«å‡†ç¡®ç‡90%+
- ğŸ¤ **åä½œæå‡**: å®æ—¶åä½œï¼Œå›¢é˜Ÿæ•ˆç‡æå‡50%
- ğŸ“Š **è¿½æº¯æ€§**: å®Œæ•´æµç¨‹å›¾è°±ï¼Œ100%å¯è¿½æº¯

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024-11-29  
**æŠ€æœ¯è´Ÿè´£äºº**: AI Assistant  
**é¡¹ç›®çŠ¶æ€**: Phase 1 å®Œæˆï¼ŒPhase 2 è¿›è¡Œä¸­
