# ğŸš€ å®¡è®¡èŠ‚ç‚¹ç³»ç»Ÿæ¶æ„é‡æ„è®¡åˆ’

**åˆ¶å®šæ—¶é—´**: 2025-12-02 10:55  
**é‡æ„ç›®æ ‡**: ComfyUIé£æ ¼ + å®¡è®¡ä¸“ä¸šé€»è¾‘ + AIé©±åŠ¨

---

## ğŸ¯ é‡æ„ç›®æ ‡

### æ ¸å¿ƒèƒ½åŠ›
- âœ… **ç±»å‹é©±åŠ¨** - Records/Ledger/Evidence/RiskSetå®Œæ•´ç±»å‹ç³»ç»Ÿ
- âœ… **AIé©±åŠ¨** - LLMèŠ‚ç‚¹ã€OCRèŠ‚ç‚¹ã€é£é™©è¯„ä¼°èŠ‚ç‚¹
- âœ… **è¯æ®é“¾** - å¯è¿½æº¯ã€å¯å¤æ ¸çš„å®¡è®¡åº•ç¨¿ç”Ÿæˆ
- âœ… **å¯ç»„åˆ** - åƒComfyUIä¸€æ ·çš„èŠ‚ç‚¹ç»„åˆèƒ½åŠ›
- âœ… **å¯é‡ç”¨** - åƒBlenderä¸€æ ·çš„Group Node
- âœ… **å¯æ‰©å±•** - æ’ä»¶åŒ–çš„èˆå¼Šæ£€æµ‹èŠ‚ç‚¹

### å¯¹æ ‡ç³»ç»Ÿ
- ğŸ¨ **ComfyUI** - èŠ‚ç‚¹ç³»ç»Ÿã€ç±»å‹ç³»ç»Ÿã€æ‰§è¡Œè°ƒåº¦
- ğŸ”® **Blender Geometry Nodes** - å¤åˆèŠ‚ç‚¹ã€å¯é‡ç”¨æ€§
- ğŸ“Š **å®¡è®¡ä¸“ä¸š** - åº•ç¨¿ã€è¯æ®é“¾ã€é£é™©æ¨¡å‹

---

## ğŸ§¨ å½“å‰ç³»ç»Ÿçš„æ ¹æœ¬é—®é¢˜

### 1. èŠ‚ç‚¹å¤ª"æµ…å±‚"
âŒ åªåšç®€å•æ“ä½œï¼ˆè¿‡æ»¤ã€èšåˆã€å¯¹æ¯”ï¼‰  
âŒ æ²¡æœ‰å®¡è®¡é£é™©é€»è¾‘  
âŒ æ²¡æœ‰å®¡è®¡åº•ç¨¿é€»è¾‘  
âŒ æ²¡æœ‰AIè¯­ä¹‰æŠ½è±¡  
âŒ æ²¡æœ‰è¯æ®é“¾é”å®š  

### 2. æ²¡æœ‰ç±»å‹ç³»ç»Ÿ
âŒ æ‰€æœ‰è¾“å…¥éƒ½æ˜¯`data: array`  
âŒ èŠ‚ç‚¹æ— æ³•ä¿éšœè¾“å…¥åˆè§„  
âŒ å®¡è®¡é€»è¾‘éš¾ä»¥æ²‰æ·€  
âŒ èŠ‚ç‚¹æ— æ³•è‡ªåŠ¨æ¨è  

### 3. ç¼ºä¹ç¼–è¯‘å™¨
âŒ é¡ºåºæ‰§è¡Œï¼Œæ— ä¼˜åŒ–  
âŒ æ— å¹¶è¡ŒåŒ–èƒ½åŠ›  
âŒ æ— å­—æ®µä¾èµ–åˆ†æ  
âŒ æ— é£é™©é“¾å›æº¯  
âŒ æ— è¯æ®è‡ªåŠ¨ç»‘å®š  

---

## ğŸ—ï¸ æ–°æ¶æ„è®¾è®¡

### ä¸€ã€å®¡è®¡ç±»å‹ç³»ç»Ÿ

```typescript
// æ ¸å¿ƒæ•°æ®ç±»å‹
type Records = {
  type: 'Records';
  schema: FieldSchema[];
  data: Record<string, any>[];
  metadata: DataMetadata;
}

type Ledger = {
  type: 'Ledger';
  accounts: Account[];
  entries: LedgerEntry[];
  period: DateRange;
}

type Vouchers = {
  type: 'Vouchers';
  vouchers: Voucher[];
  attachments: Attachment[];
}

type Invoices = {
  type: 'Invoices';
  invoices: Invoice[];
  validation: ValidationResult[];
}

type BankFlow = {
  type: 'BankFlow';
  transactions: Transaction[];
  accounts: BankAccount[];
}

type RiskSet = {
  type: 'RiskSet';
  risks: RiskItem[];
  severity: 'low' | 'medium' | 'high' | 'critical';
  evidence: EvidenceLink[];
}

type Evidence = {
  type: 'Evidence';
  items: EvidenceItem[];
  traceId: string;
  workflow: WorkflowSnapshot;
}

type DraftPage = {
  type: 'DraftPage';
  sections: DraftSection[];
  evidence: Evidence[];
  conclusion: string;
}

type ReportSection = {
  type: 'ReportSection';
  title: string;
  content: string;
  pages: DraftPage[];
}
```

### äºŒã€èŠ‚ç‚¹åˆ†ç±»ä½“ç³»ï¼ˆ40+èŠ‚ç‚¹ï¼‰

#### ğŸ“¥ A. è¾“å…¥ç±»ï¼ˆ7ä¸ªï¼‰
1. **VoucherInput** - å‡­è¯è¾“å…¥
2. **ContractInput** - åˆåŒè¾“å…¥
3. **BankFlowInput** - é“¶è¡Œæµæ°´è¾“å…¥
4. **InventoryInput** - åº“å­˜æ•°æ®è¾“å…¥
5. **InvoiceImageInput** - å‘ç¥¨å›¾ç‰‡è¾“å…¥
6. **ERPApiInput** - ERP APIæ‹‰å–
7. **ManualField** - æ‰‹åŠ¨å˜é‡

#### ğŸ”§ B. é¢„å¤„ç†ç±»ï¼ˆ6ä¸ªï¼‰
1. **NormalizeData** - æ•°æ®æ ‡å‡†åŒ–
2. **OCRExtract** - OCRæå–
3. **CleanText** - æ–‡æœ¬æ¸…æ´—
4. **FieldMapper** - å­—æ®µæ˜ å°„
5. **MergeRows** - æ•°æ®åˆå¹¶
6. **GroupBy** - æ•°æ®åˆ†ç»„

#### ğŸ” C. å®¡è®¡ä¸“ç”¨èŠ‚ç‚¹ï¼ˆ12ä¸ªï¼‰
1. **ThreeDocMatch** - ä¸‰å•åŒ¹é…
2. **AmountFilter** - é‡‘é¢åŒºé—´ç­›é€‰
3. **DateAnomalyFilter** - å¼‚å¸¸æ—¥æœŸç­›é€‰
4. **DuplicateVoucherDetect** - é‡å¤å‡­è¯æ£€æµ‹
5. **SplitVoucherDetect** - å¼‚å¸¸æ‹†åˆ†æ£€æµ‹
6. **GreyRevenueDetect** - ç°è‰²æ”¶å…¥æ£€æµ‹
7. **FundLoopDetect** - èµ„é‡‘å¾ªç¯æ£€æµ‹
8. **SupplierRiskScore** - ä¾›åº”å•†é£é™©åˆ†çº§
9. **CostVarianceDetect** - æˆæœ¬å¼‚å¸¸æ³¢åŠ¨
10. **ContractStructureDetect** - è™šå‡åˆåŒæ£€æµ‹
11. **AmountContractDeviation** - é‡‘é¢åˆåŒåå·®
12. **FraudPatternMatch** - èˆå¼Šæ¨¡å¼åŒ¹é…

#### ğŸ§  D. AIåˆ†æèŠ‚ç‚¹ï¼ˆ7ä¸ªï¼‰
1. **AI_RiskAssess** - AIé£é™©è¯„ä¼°
2. **LLM_TextParser** - GPTæ–‡æœ¬è§£æ
3. **LLM_OCRFix** - OCR AIçº é”™
4. **AI_FakeInvoice** - AIå‘ç¥¨çœŸä¼ªåˆ†æ
5. **AI_RelatedParty** - AIå…³è”æ–¹è¯†åˆ«
6. **AI_BusinessReasoning** - AIä¸šåŠ¡é“¾æ¨ç†
7. **AI_ConclusionWriter** - AIå®¡è®¡ç»“è®ºç”Ÿæˆ

#### ğŸ“Š E. åˆ†æè¿ç®—èŠ‚ç‚¹ï¼ˆ5ä¸ªï¼‰
1. **StatSummary** - ç»Ÿè®¡æ±‡æ€»
2. **SegmentAnomaly** - å¼‚å¸¸åˆ†æ®µ
3. **ClusterKMeans** - èšç±»åˆ†æ
4. **PathTrace** - è·¯å¾„è¿½è¸ª
5. **Correlation** - ç›¸å…³æ€§åˆ†æ

#### ğŸ› ï¸ F. å·¥å…·è¾…åŠ©ç±»ï¼ˆ6ä¸ªï¼‰
1. **JSONViewer** - JSONæŸ¥çœ‹å™¨
2. **LogNode** - æ—¥å¿—èŠ‚ç‚¹
3. **IfElse** - æ¡ä»¶èŠ‚ç‚¹
4. **ForEach** - LoopèŠ‚ç‚¹
5. **CacheNode** - æ•°æ®ç¼“å­˜
6. **ParallelRun** - å¹¶è¡ŒèŠ‚ç‚¹

#### ğŸ“¤ G. è¾“å‡ºç±»ï¼ˆ4ä¸ªï¼‰
1. **ReportGenerator** - å®¡è®¡æŠ¥å‘Šç”Ÿæˆ
2. **WorkpaperGenerator** - ç»“æ„åŒ–åº•ç¨¿ç”Ÿæˆ
3. **ChartOutput** - å›¾è¡¨è¾“å‡º
4. **NodeGraphExport** - Graphå¯¼å‡º

### ä¸‰ã€å®¡è®¡èŠ‚ç‚¹ç¼–è¯‘å™¨ï¼ˆAuditNodeCompilerï¼‰

```typescript
class AuditNodeCompiler {
  // 1. ç±»å‹æ£€æŸ¥
  validateTypes(graph: NodeGraph): TypeCheckResult;
  
  // 2. å­—æ®µä¾èµ–è¿½è¸ª
  analyzeFieldDependencies(graph: NodeGraph): DependencyGraph;
  
  // 3. é£é™©ä¼ æ’­åˆ†æ
  traceRiskFlow(graph: NodeGraph): RiskFlowMap;
  
  // 4. æ•°æ®é‡é¢„ä¼°
  estimateDataVolume(graph: NodeGraph): VolumeEstimate;
  
  // 5. è‡ªåŠ¨å¹¶è¡Œæ‰§è¡Œ
  generateParallelPlan(graph: NodeGraph): ExecutionPlan;
  
  // 6. å†—ä½™èŠ‚ç‚¹è£å‰ª
  optimizeGraph(graph: NodeGraph): OptimizedGraph;
  
  // 7. è‡ªåŠ¨ç”Ÿæˆè¯æ®é“¾å›¾
  generateEvidenceChain(graph: NodeGraph): EvidenceChain;
}
```

### å››ã€å¤åˆèŠ‚ç‚¹ç³»ç»Ÿï¼ˆGroup Nodeï¼‰

```typescript
// å¯å°è£…çš„å®¡è®¡æµç¨‹æ¨¡å—
class CompoundNode {
  id: string;
  name: string;
  category: 'audit' | 'fraud' | 'analysis';
  subGraph: NodeGraph;
  exposedInputs: Port[];
  exposedOutputs: Port[];
  metadata: {
    author: string;
    version: string;
    description: string;
    tags: string[];
  };
}

// ç¤ºä¾‹ï¼šé“¶è¡Œå¯¹è´¦æµç¨‹
const BankReconciliationNode: CompoundNode = {
  name: 'é“¶è¡Œå¯¹è´¦æµç¨‹',
  subGraph: {
    nodes: [
      { type: 'BankFlowInput' },
      { type: 'LedgerInput' },
      { type: 'ThreeDocMatch' },
      { type: 'AI_RiskAssess' },
      { type: 'WorkpaperGenerator' }
    ]
  }
};
```

---

## ğŸ“‹ å®æ–½é˜¶æ®µ

### Phase 1: åŸºç¡€æ¶æ„ï¼ˆç¬¬1-2å‘¨ï¼‰
- [x] åˆ›å»ºç±»å‹ç³»ç»Ÿå®šä¹‰
- [ ] å®ç°NodeRegistry V3
- [ ] è®¾è®¡ç¼–è¯‘å™¨æ¥å£
- [ ] æ›´æ–°èŠ‚ç‚¹åŸºç±»

### Phase 2: æ ¸å¿ƒèŠ‚ç‚¹ï¼ˆç¬¬3-4å‘¨ï¼‰
- [ ] å®ç°7ä¸ªè¾“å…¥èŠ‚ç‚¹
- [ ] å®ç°6ä¸ªé¢„å¤„ç†èŠ‚ç‚¹
- [ ] å®ç°12ä¸ªå®¡è®¡èŠ‚ç‚¹
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–

### Phase 3: AIèƒ½åŠ›ï¼ˆç¬¬5-6å‘¨ï¼‰
- [ ] é›†æˆLLMèŠ‚ç‚¹
- [ ] é›†æˆOCRèŠ‚ç‚¹
- [ ] å®ç°é£é™©è¯„ä¼°èŠ‚ç‚¹
- [ ] AIç¼“å­˜å’Œé‡è¯•æœºåˆ¶

### Phase 4: ç¼–è¯‘å™¨ï¼ˆç¬¬7-8å‘¨ï¼‰
- [ ] ç±»å‹æ£€æŸ¥å™¨
- [ ] ä¾èµ–åˆ†æå™¨
- [ ] å¹¶è¡Œè°ƒåº¦å™¨
- [ ] è¯æ®é“¾ç”Ÿæˆå™¨

### Phase 5: å¤åˆèŠ‚ç‚¹ï¼ˆç¬¬9-10å‘¨ï¼‰
- [ ] Group Nodeç³»ç»Ÿ
- [ ] èŠ‚ç‚¹å¸‚åœº
- [ ] å¯¼å…¥/å¯¼å‡º
- [ ] ç‰ˆæœ¬æ§åˆ¶

### Phase 6: UIé‡æ„ï¼ˆç¬¬11-12å‘¨ï¼‰
- [ ] é›†æˆRete.js
- [ ] å¤šè§†å›¾ç•Œé¢
- [ ] è¯æ®é“¾å¯è§†åŒ–
- [ ] åº•ç¨¿é¢„è§ˆ

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆé€‰å‹

### èŠ‚ç‚¹å›¾å¼•æ“
**é€‰æ‹©**: Rete.js v2 â­â­â­â­â­
- å®Œå…¨é€‚é…ComfyUIé£æ ¼
- TypeScriptæ”¯æŒå®Œå–„
- å¯æ‰©å±•æ€§å¼º

### å·¥ä½œæµæ‰§è¡Œ
**é€‰æ‹©**: è‡ªç ” + Temporal.ioï¼ˆå¯é€‰ï¼‰
- è‡ªç ”è½»é‡è°ƒåº¦å™¨ï¼ˆPhase 1-3ï¼‰
- Temporal.ioç”¨äºç”Ÿäº§çº§è°ƒåº¦ï¼ˆPhase 4+ï¼‰

### AIæ‰§è¡Œå±‚
**é€‰æ‹©**: OpenAI API + DeepSeek R1
- OpenAIç”¨äºç”Ÿäº§ç¯å¢ƒ
- DeepSeekç”¨äºæœ¬åœ°æ¨ç†
- OCRä½¿ç”¨PaddleOCR

### æ•°æ®åº“
**é€‰æ‹©**: DuckDB + SQLite
- DuckDBç”¨äºå¤§æ•°æ®æŸ¥è¯¢
- SQLiteç”¨äºèŠ‚ç‚¹å›¾å­˜å‚¨

### UIæ¡†æ¶
**é€‰æ‹©**: React + Rete.js
- æœ€æ¥è¿‘ComfyUIæ•ˆæœ
- ç”Ÿæ€æˆç†Ÿ

---

## ğŸ“Š è¿ç§»ç­–ç•¥

### å‘åå…¼å®¹
1. **ä¿ç•™æ—§èŠ‚ç‚¹** - æ ‡è®°ä¸ºdeprecated
2. **é€‚é…å™¨æ¨¡å¼** - æ—§èŠ‚ç‚¹è‡ªåŠ¨è½¬æ¢ä¸ºæ–°ç±»å‹
3. **æ¸è¿›å¼è¿ç§»** - ç”¨æˆ·å¯é€æ­¥å‡çº§å·¥ä½œæµ

### æ•°æ®è¿ç§»
```typescript
// æ—§èŠ‚ç‚¹ â†’ æ–°èŠ‚ç‚¹æ˜ å°„
const migrationMap = {
  'data.csv_reader': 'input.records',
  'data.filter': 'preprocess.filter',
  'audit.data_compare': 'audit.three_doc_match'
};
```

---

## ğŸ¯ éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½æ€§
- [ ] 40+èŠ‚ç‚¹å…¨éƒ¨å®ç°
- [ ] ç±»å‹ç³»ç»Ÿå®Œæ•´
- [ ] ç¼–è¯‘å™¨é€šè¿‡æ‰€æœ‰æµ‹è¯•
- [ ] å¤åˆèŠ‚ç‚¹å¯åˆ›å»ºå’Œå…±äº«

### æ€§èƒ½
- [ ] 1000èŠ‚ç‚¹å›¾<1sç¼–è¯‘
- [ ] å¹¶è¡Œæ‰§è¡Œæå‡50%+
- [ ] è¯æ®é“¾ç”Ÿæˆ<100ms

### å¯ç”¨æ€§
- [ ] èŠ‚ç‚¹æ™ºèƒ½æ¨èå‡†ç¡®ç‡>80%
- [ ] åº•ç¨¿è‡ªåŠ¨ç”Ÿæˆå‡†ç¡®ç‡>90%
- [ ] æ–‡æ¡£è¦†ç›–ç‡100%

---

## ğŸ“š å‚è€ƒèµ„æ–™

- ComfyUIæºç : https://github.com/comfyanonymous/ComfyUI
- Rete.jsæ–‡æ¡£: https://rete.js.org/
- Blender Geometry Nodes: https://docs.blender.org/manual/en/latest/modeling/geometry_nodes/
- å®¡è®¡å‡†åˆ™: ä¸­å›½æ³¨å†Œä¼šè®¡å¸ˆå®¡è®¡å‡†åˆ™

---

**ä¸‹ä¸€æ­¥**: ç«‹å³å¼€å§‹Phase 1 - åˆ›å»ºç±»å‹ç³»ç»Ÿ
