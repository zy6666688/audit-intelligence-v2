# 节点方案基线

> **节点设计规范（对标 ComfyUI）**

---

## 🎯 目标与定位

- 参考 ComfyUI 的节点定义规范，统一输入输出、默认值与校验
- 为常用节点提供可复用的设计、文档与验收清单
- 降低新增节点的沟通与维护成本

---

## 📋 节点设计原则

### 1. 输入清晰
- `INPUT_TYPES` 定义类型、范围、默认值
- 枚举/数值需带边界
- 布尔参数给出默认语义

### 2. 输出确定
- `RETURN_TYPES`/`RETURN_NAMES` 与前端 UI 一致
- 保证幂等（相同输入 → 相同输出）
- 必要时标注非幂等原因

### 3. 资源保护
- 为大数据集提供采样或分页（示例：`MAX_DATA_POINTS=1000`）
- 对长耗时任务支持超时与进度事件

### 4. 状态管理
- 避免持久化隐式状态
- 缓存需记录有效期
- 输出文件限定在 `backend/output/` 以内

### 5. 可恢复性
- 显式错误信息（可返回错误用的可视化 JSON）
- 对必填列缺失、文件不存在给出引导性提示

### 6. 组合友好
- 输入输出类型可与其它通用节点拼装（DataFrame/STRING/FILE 等）
- 避免专属定制格式

---

## 📝 文档要求

每个节点文档应包含：

1. **场景与定位** - 对应审计阶段/业务域
2. **输入/输出清单** - 类型、必填、默认值、枚举范围
3. **运行参数与限制** - 批量大小/超时/采样策略/最大行数
4. **数据契约** - DataFrame 列要求、文件路径规范、编码/时区约定
5. **错误处理与恢复** - 重试策略、兜底输出、错误文案
6. **性能与资源** - 内存/CPU 预估，何时触发采样或降级
7. **安全要求** - 沙箱/黑白名单/敏感字段脱敏
8. **示例工作流片段** - JSON 片段或连接示意
9. **验收测试要点** - 必测用例列表

---

## 🧪 测试与验收

### 单元测试
- 为复杂节点提供最小覆盖（正常路径、边界/空输入、异常提示）
- 存放于 `backend/tests/test_<node>.py`

### 集成检查
- 示例工作流运行通过（如 `backend/workflows/` 中样例）
- 前端拖拽与属性面板渲染正常

### 兼容性
- 验证不同数据量、不同编码/时区、常见 OS 路径差异
- 确保类型提示与文档一致

---

## 📦 版本与发布

- 同步更新锁文件与文档（README/节点文档）
- 注明新增/变更的节点版本、依赖变化与迁移指引
- 变更摘要遵循语义化（新增/变更/修复/弃用）
- 必要时提供向后兼容策略或迁移步骤

---

## 🔗 参考项目

- **ComfyUI**: 节点元数据与 UI 自动生成模式
- **Vite + Vue3**: 组件按需加载、ECharts 渲染与异步数据面板实践

---

**更多信息**: 
- [节点开发指南](./development-guide.md) - 如何开发节点
- [节点使用指南](./user-guide.md) - 节点使用说明

