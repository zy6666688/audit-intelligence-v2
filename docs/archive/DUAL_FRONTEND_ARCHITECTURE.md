# ğŸ—ï¸ åŒå‰ç«¯+å¤§åç«¯æ¶æ„æ–¹æ¡ˆ

**æå‡ºæ—¶é—´**: 2025-12-01 13:07  
**èƒŒæ™¯**: Canvasç»„ä»¶åœ¨å°ç¨‹åºä¸­å­˜åœ¨å…¼å®¹æ€§å’Œæ€§èƒ½é—®é¢˜  
**æ–¹æ¡ˆ**: é‡‡ç”¨åŒå‰ç«¯æ¨¡å¼ï¼ŒH5å’Œå°ç¨‹åºåˆ†ç¦»å¼€å‘ï¼Œå…±äº«å¤§åç«¯

---

## ğŸ¯ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   H5 Webå‰ç«¯         â”‚     å°ç¨‹åºå‰ç«¯                     â”‚
â”‚  (å®Œæ•´å¯è§†åŒ–ç¼–è¾‘å™¨)   â”‚  (æŸ¥çœ‹+ç®€åŒ–æ“ä½œ)                  â”‚
â”‚                      â”‚                                   â”‚
â”‚  æŠ€æœ¯æ ˆ:             â”‚  æŠ€æœ¯æ ˆ:                          â”‚
â”‚  - Vue 3             â”‚  - åŸç”Ÿå°ç¨‹åº                     â”‚
â”‚  - Vue Flow          â”‚  - viewç»„ä»¶å¸ƒå±€                   â”‚
â”‚  - TypeScript        â”‚  - æ— Canvas                       â”‚
â”‚  - Pinia             â”‚  - è½»é‡åŒ–                         â”‚
â”‚                      â”‚                                   â”‚
â”‚  åŠŸèƒ½:               â”‚  åŠŸèƒ½:                            â”‚
â”‚  âœ… å®Œæ•´èŠ‚ç‚¹ç¼–è¾‘     â”‚  âœ… å·¥ä½œæµåˆ—è¡¨                    â”‚
â”‚  âœ… æ‹–æ‹½è¿çº¿         â”‚  âœ… å·¥ä½œæµæŸ¥çœ‹                    â”‚
â”‚  âœ… å·¥ä½œæµåˆ›å»º       â”‚  âœ… ä¸€é”®æ‰§è¡Œ                      â”‚
â”‚  âœ… å¤æ‚é…ç½®         â”‚  âœ… è¿›åº¦æŸ¥çœ‹                      â”‚
â”‚  âœ… è°ƒè¯•å·¥å…·         â”‚  âœ… ç»“æœæŸ¥çœ‹                      â”‚
â”‚                      â”‚  âœ… ç®€å•ç¼–è¾‘                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚  ç»Ÿä¸€APIè°ƒç”¨
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¤§åç«¯æœåŠ¡å±‚                            â”‚
â”‚                                                           â”‚
â”‚  æŠ€æœ¯æ ˆ: Express.js + TypeScript                         â”‚
â”‚                                                           â”‚
â”‚  æ ¸å¿ƒæ¨¡å—:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å·¥ä½œæµå¼•æ“      â”‚   èŠ‚ç‚¹æ³¨å†Œä¸­å¿ƒ   â”‚  ä»»åŠ¡è°ƒåº¦å™¨  â”‚   â”‚
â”‚  â”‚  FlowEngine     â”‚  NodeRegistry   â”‚  TaskQueue   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                           â”‚
â”‚  APIæœåŠ¡:                                                â”‚
â”‚  âœ… å·¥ä½œæµCRUD        âœ… èŠ‚ç‚¹ç®¡ç†        âœ… ä»»åŠ¡æ‰§è¡Œ      â”‚
â”‚  âœ… æ¨¡æ¿ç®¡ç†          âœ… æ‰§è¡Œå†å²        âœ… ç»“æœæŸ¥è¯¢      â”‚
â”‚  âœ… ç”¨æˆ·æƒé™          âœ… æ•°æ®ç»Ÿè®¡        âœ… AIé›†æˆ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®æŒä¹…å±‚                              â”‚
â”‚  PostgreSQL + Redis                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± å‰ç«¯å¯¹æ¯”

### H5å‰ç«¯ - ä¸“ä¸šå·¥ä½œå°

**å®šä½**: å®Œæ•´çš„å¯è§†åŒ–å·¥ä½œæµç¼–è¾‘å™¨

**æŠ€æœ¯é€‰å‹**:
```typescript
{
  "framework": "Vue 3 + TypeScript",
  "ui": "Element Plus / Ant Design Vue",
  "canvas": "Vue Flow (ä¸“ä¸šæ–¹æ¡ˆ)",
  "state": "Pinia",
  "router": "Vue Router"
}
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… å®Œæ•´çš„èŠ‚ç‚¹å›¾ç¼–è¾‘å™¨
- âœ… æ‹–æ‹½å¼å·¥ä½œæµè®¾è®¡
- âœ… èŠ‚ç‚¹åº“é¢æ¿ï¼ˆåˆ†ç±»å±•ç¤ºï¼‰
- âœ… å±æ€§é…ç½®é¢æ¿
- âœ… å®æ—¶é¢„è§ˆå’Œè°ƒè¯•
- âœ… å·¥ä½œæµæ¨¡æ¿å¸‚åœº
- âœ… ç‰ˆæœ¬å†å²ç®¡ç†
- âœ… åä½œç¼–è¾‘ï¼ˆå¤šäººï¼‰

**é€‚ç”¨åœºæ™¯**:
- å·¥ä½œæµè®¾è®¡å’Œè°ƒè¯•
- å¤æ‚ä¸šåŠ¡é…ç½®
- å¤§å±å±•ç¤ºå’Œç›‘æ§

---

### å°ç¨‹åºå‰ç«¯ - ç§»åŠ¨æ‰§è¡Œå™¨

**å®šä½**: è½»é‡åŒ–çš„å·¥ä½œæµæŸ¥çœ‹å’Œæ‰§è¡Œå·¥å…·

**æŠ€æœ¯é€‰å‹**:
```typescript
{
  "framework": "åŸç”Ÿå°ç¨‹åº (å¾®ä¿¡/æ”¯ä»˜å®)",
  "ui": "åŸç”Ÿç»„ä»¶ + WeUI/Mini-UI",
  "layout": "view + scroll-view",
  "canvas": "ä¸ä½¿ç”¨",
  "state": "é¡µé¢çº§çŠ¶æ€"
}
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… å·¥ä½œæµåˆ—è¡¨ï¼ˆå¡ç‰‡å¼ï¼‰
- âœ… å·¥ä½œæµè¯¦æƒ…ï¼ˆèŠ‚ç‚¹åˆ—è¡¨ï¼‰
- âœ… ä¸€é”®æ‰§è¡Œå·¥ä½œæµ
- âœ… å®æ—¶è¿›åº¦æŸ¥çœ‹
- âœ… æ‰§è¡Œç»“æœæŸ¥çœ‹
- âœ… å†å²è®°å½•æŸ¥è¯¢
- âœ… å¿«æ·æ“ä½œï¼ˆæ”¶è—ã€åˆ†äº«ï¼‰
- âš ï¸ ç®€åŒ–ç¼–è¾‘ï¼ˆä»…å‚æ•°è°ƒæ•´ï¼‰

**ç•Œé¢è®¾è®¡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ  æˆ‘çš„å·¥ä½œæµ          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“ æ”¶å…¥å®¡è®¡æµç¨‹     â”‚ â”‚
â”‚ â”‚ 5ä¸ªèŠ‚ç‚¹ | 3åˆ†é’Ÿå‰   â”‚ â”‚
â”‚ â”‚ [æ‰§è¡Œ] [è¯¦æƒ…]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âš ï¸ é£é™©è¯„ä¼°æµç¨‹     â”‚ â”‚
â”‚ â”‚ 3ä¸ªèŠ‚ç‚¹ | 1å°æ—¶å‰   â”‚ â”‚
â”‚ â”‚ [æ‰§è¡Œ] [è¯¦æƒ…]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‚¹å‡»è¯¦æƒ… â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† æ”¶å…¥å®¡è®¡æµç¨‹          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æµç¨‹æ­¥éª¤ï¼ˆç«–å‘åˆ—è¡¨ï¼‰     â”‚
â”‚                         â”‚
â”‚ 1ï¸âƒ£ CSVè¯»å–              â”‚
â”‚    â”œâ”€ çŠ¶æ€: âœ… å®Œæˆ     â”‚
â”‚    â””â”€ è€—æ—¶: 0.5s       â”‚
â”‚         â–¼               â”‚
â”‚ 2ï¸âƒ£ æ•°æ®è¿‡æ»¤             â”‚
â”‚    â”œâ”€ çŠ¶æ€: âœ… å®Œæˆ     â”‚
â”‚    â””â”€ è€—æ—¶: 0.3s       â”‚
â”‚         â–¼               â”‚
â”‚ 3ï¸âƒ£ é£é™©è¯„ä¼°             â”‚
â”‚    â”œâ”€ çŠ¶æ€: ğŸ”„ è¿è¡Œä¸­   â”‚
â”‚    â””â”€ è¿›åº¦: 65%        â”‚
â”‚         â–¼               â”‚
â”‚ 4ï¸âƒ£ ç”ŸæˆæŠ¥å‘Š             â”‚
â”‚    â””â”€ çŠ¶æ€: â³ ç­‰å¾…     â”‚
â”‚                         â”‚
â”‚ [â–¶ï¸ æ‰§è¡Œ] [âš™ï¸ é…ç½®]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ä½¿ç”¨Canvasçš„æ–¹æ¡ˆ**:
- ç”¨ `view` ç»„ä»¶å †å è¡¨ç¤ºèŠ‚ç‚¹
- ç”¨ç®­å¤´å›¾æ ‡/è™šçº¿åˆ†éš”è¡¨ç¤ºè¿æ¥
- å‚ç›´å¸ƒå±€ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰
- ç®€åŒ–ä¸ºåˆ—è¡¨è§†å›¾ï¼Œè€Œéè‡ªç”±ç”»å¸ƒ

**é€‚ç”¨åœºæ™¯**:
- ç§»åŠ¨åŠå…¬å¿«é€Ÿæ‰§è¡Œ
- æŸ¥çœ‹å·¥ä½œæµçŠ¶æ€
- å®¡æ‰¹å’Œç¡®è®¤æ“ä½œ
- ç®€å•å‚æ•°è°ƒæ•´

---

## ğŸ”§ å¤§åç«¯è®¾è®¡

### APIåˆ†å±‚

```typescript
// 1ï¸âƒ£ å·¥ä½œæµç®¡ç†å±‚
GET    /api/workflows                 // è·å–åˆ—è¡¨
POST   /api/workflows                 // åˆ›å»ºå·¥ä½œæµ
GET    /api/workflows/:id             // è·å–è¯¦æƒ…
PUT    /api/workflows/:id             // æ›´æ–°å·¥ä½œæµ
DELETE /api/workflows/:id             // åˆ é™¤å·¥ä½œæµ
POST   /api/workflows/:id/clone       // å…‹éš†å·¥ä½œæµ
GET    /api/workflows/:id/versions    // ç‰ˆæœ¬å†å²

// 2ï¸âƒ£ å·¥ä½œæµæ¨¡æ¿å±‚
GET    /api/templates                 // æ¨¡æ¿åˆ—è¡¨
GET    /api/templates/:id             // æ¨¡æ¿è¯¦æƒ…
POST   /api/workflows/:id/save-as-template  // ä¿å­˜ä¸ºæ¨¡æ¿

// 3ï¸âƒ£ æ‰§è¡Œå¼•æ“å±‚
POST   /api/execute/workflow/:id      // æ‰§è¡Œå·¥ä½œæµ
POST   /api/execute/node              // å•èŠ‚ç‚¹æµ‹è¯•
GET    /api/execute/tasks/:taskId     // æŸ¥è¯¢ä»»åŠ¡
POST   /api/execute/tasks/:taskId/cancel  // å–æ¶ˆä»»åŠ¡
GET    /api/execute/history           // æ‰§è¡Œå†å²

// 4ï¸âƒ£ èŠ‚ç‚¹ç®¡ç†å±‚
GET    /api/nodes/library             // èŠ‚ç‚¹åº“ï¼ˆåˆ†ç±»ï¼‰
GET    /api/nodes/:type               // èŠ‚ç‚¹è¯¦æƒ…
POST   /api/nodes/:type/validate      // éªŒè¯é…ç½®

// 5ï¸âƒ£ æ•°æ®ç®¡ç†å±‚
GET    /api/data/results/:taskId      // è·å–ç»“æœ
GET    /api/data/export/:taskId       // å¯¼å‡ºæ•°æ®
POST   /api/data/upload               // ä¸Šä¼ æ–‡ä»¶

// 6ï¸âƒ£ ç”¨æˆ·ç®¡ç†å±‚
GET    /api/user/profile              // ç”¨æˆ·ä¿¡æ¯
GET    /api/user/workflows            // æˆ‘çš„å·¥ä½œæµ
GET    /api/user/favorites            // æ”¶è—åˆ—è¡¨
```

### æ•°æ®æ¨¡å‹

```typescript
// å·¥ä½œæµæ¨¡å‹
interface Workflow {
  id: string;
  name: string;
  description: string;
  category: string;
  
  // æ ¸å¿ƒæ•°æ®
  nodes: Node[];
  connections: Connection[];
  
  // å…ƒæ•°æ®
  ownerId: string;
  isPublic: boolean;
  tags: string[];
  
  // ç»Ÿè®¡
  executionCount: number;
  lastExecutedAt?: Date;
  avgExecutionTime?: number;
  
  // ç‰ˆæœ¬
  version: number;
  createdAt: Date;
  updatedAt: Date;
}

// æ‰§è¡Œä»»åŠ¡æ¨¡å‹
interface ExecutionTask {
  id: string;
  workflowId: string;
  workflowVersion: number;
  
  // æ‰§è¡ŒçŠ¶æ€
  status: 'pending' | 'running' | 'completed' | 'failed' | 'cancelled';
  progress: number;
  
  // æ‰§è¡Œç»“æœ
  startTime: Date;
  endTime?: Date;
  duration?: number;
  nodeResults: Record<string, any>;
  finalOutput?: any;
  error?: string;
  
  // æ‰§è¡Œç¯å¢ƒ
  userId: string;
  triggeredBy: 'manual' | 'schedule' | 'api';
  environment: 'h5' | 'miniapp' | 'api';
}

// èŠ‚ç‚¹æ‰§è¡Œè®°å½•
interface NodeExecutionLog {
  taskId: string;
  nodeId: string;
  nodeType: string;
  
  status: 'pending' | 'running' | 'completed' | 'failed';
  startTime: Date;
  endTime?: Date;
  duration?: number;
  
  input?: any;
  output?: any;
  error?: string;
  
  metrics: {
    memoryUsed?: number;
    cpuTime?: number;
  };
}
```

---

## ğŸ’¡ å®ç°æ–¹æ¡ˆ

### é˜¶æ®µä¸€ï¼šé‡æ„å°ç¨‹åºå‰ç«¯ï¼ˆ1-2å¤©ï¼‰

**ç§»é™¤Canvasç»„ä»¶**:

```vue
<!-- âŒ æ—§æ–¹æ¡ˆ: Canvas -->
<canvas canvas-id="flowCanvas" @touchstart="..." />

<!-- âœ… æ–°æ–¹æ¡ˆ: Viewåˆ—è¡¨ -->
<scroll-view scroll-y class="workflow-view">
  <view 
    v-for="node in sortedNodes" 
    :key="node.id"
    class="node-card"
  >
    <!-- èŠ‚ç‚¹å›¾æ ‡å’Œä¿¡æ¯ -->
    <view class="node-header">
      <text class="node-icon">{{ node.icon }}</text>
      <text class="node-title">{{ node.title }}</text>
    </view>
    
    <!-- èŠ‚ç‚¹çŠ¶æ€ -->
    <view class="node-status" :class="node.status">
      {{ getStatusText(node.status) }}
    </view>
    
    <!-- è¿æ¥çº¿ï¼ˆè§†è§‰æ•ˆæœï¼‰ -->
    <view v-if="!isLastNode(node)" class="connection-line">
      <view class="arrow-down">â–¼</view>
    </view>
  </view>
</scroll-view>
```

**æ–°ç»„ä»¶ç»“æ„**:
```
src/pages-miniapp/
â”œâ”€â”€ workflow/
â”‚   â”œâ”€â”€ list.vue           # å·¥ä½œæµåˆ—è¡¨
â”‚   â”œâ”€â”€ detail.vue         # å·¥ä½œæµè¯¦æƒ…ï¼ˆèŠ‚ç‚¹åˆ—è¡¨ï¼‰
â”‚   â”œâ”€â”€ execute.vue        # æ‰§è¡Œé¡µé¢
â”‚   â””â”€â”€ result.vue         # ç»“æœæŸ¥çœ‹
â”œâ”€â”€ template/
â”‚   â””â”€â”€ market.vue         # æ¨¡æ¿å¸‚åœº
â””â”€â”€ history/
    â””â”€â”€ index.vue          # æ‰§è¡Œå†å²
```

### é˜¶æ®µäºŒï¼šå¢å¼ºH5å‰ç«¯ï¼ˆ1å¤©ï¼‰

**ä¿æŒVue Flowå®ç°**:
```vue
<template>
  <div class="workflow-editor">
    <!-- ä½¿ç”¨æˆç†Ÿçš„Vue Flow -->
    <VueFlow
      v-model="elements"
      @connect="onConnect"
      @node-drag-stop="onNodeDragStop"
    >
      <Background />
      <Controls />
      <MiniMap />
    </VueFlow>
    
    <!-- ä¾§è¾¹æ  -->
    <NodeLibraryPanel />
    <PropertyPanel />
  </div>
</template>
```

### é˜¶æ®µä¸‰ï¼šå¤§åç«¯ä¼˜åŒ–ï¼ˆ2-3å¤©ï¼‰

**æ·»åŠ æ–°API**:
```typescript
// å·¥ä½œæµæ¨¡æ¿
app.get('/api/templates', async (req, res) => {
  const templates = await db.templates.findAll({
    where: { isPublic: true },
    order: [['usageCount', 'DESC']]
  });
  res.json({ code: 200, data: templates });
});

// æ‰§è¡Œå·¥ä½œæµï¼ˆå¢å¼ºç‰ˆï¼‰
app.post('/api/execute/workflow/:id', async (req, res) => {
  const { id } = req.params;
  const { inputs, config } = req.body;
  
  // è·å–å·¥ä½œæµ
  const workflow = await db.workflows.findByPk(id);
  
  // åˆ›å»ºæ‰§è¡Œä»»åŠ¡
  const task = await db.executionTasks.create({
    workflowId: id,
    workflowVersion: workflow.version,
    userId: req.user.id,
    status: 'pending',
    environment: req.headers['x-client-type'] // 'h5' or 'miniapp'
  });
  
  // å¼‚æ­¥æ‰§è¡Œ
  executeWorkflowAsync(task.id, workflow, inputs, config);
  
  res.json({ code: 200, data: { taskId: task.id } });
});

// WebSocketæ¨é€è¿›åº¦
io.on('connection', (socket) => {
  socket.on('subscribe', (taskId) => {
    // è®¢é˜…ä»»åŠ¡è¿›åº¦
    subscribeTaskProgress(taskId, (progress) => {
      socket.emit('task-progress', progress);
    });
  });
});
```

---

## ğŸ“Š æŠ€æœ¯å¯¹æ¯”

| æ–¹æ¡ˆ | Canvaså°ç¨‹åº | åŒå‰ç«¯æ¨¡å¼ |
|------|-------------|-----------|
| **å¼€å‘å¤æ‚åº¦** | é«˜ | ä¸­ |
| **ç»´æŠ¤æˆæœ¬** | é«˜ | ä¸­ |
| **æ€§èƒ½** | ä¸€èˆ¬ | ä¼˜ç§€ |
| **ç”¨æˆ·ä½“éªŒ** | å¤æ‚ | ç®€æ´ |
| **å…¼å®¹æ€§** | å·® | ä¼˜ç§€ |
| **è°ƒè¯•éš¾åº¦** | é«˜ | ä½ |
| **æ‰©å±•æ€§** | ä½ | é«˜ |
| **æ¨èåº¦** | â­â­ | â­â­â­â­â­ |

---

## ğŸš€ è¿ç§»è®¡åˆ’

### Week 1: å°ç¨‹åºé‡æ„

**Day 1-2**: ç§»é™¤Canvasç»„ä»¶
- åˆ é™¤ FlowCanvasMiniapp.vue
- åˆ›å»ºæ–°çš„é¡µé¢ç»“æ„
- å®ç°å·¥ä½œæµåˆ—è¡¨é¡µ

**Day 3-4**: å®ç°æ ¸å¿ƒé¡µé¢
- å·¥ä½œæµè¯¦æƒ…é¡µï¼ˆèŠ‚ç‚¹åˆ—è¡¨ï¼‰
- æ‰§è¡Œé¡µé¢ï¼ˆè¿›åº¦å±•ç¤ºï¼‰
- ç»“æœæŸ¥çœ‹é¡µ

**Day 5**: ä¼˜åŒ–å’Œæµ‹è¯•
- æ ·å¼è°ƒæ•´
- äº¤äº’ä¼˜åŒ–
- å¤šå¹³å°æµ‹è¯•

### Week 2: åç«¯å¢å¼º

**Day 1-2**: APIæ‰©å±•
- å·¥ä½œæµæ¨¡æ¿API
- æ‰§è¡Œå†å²API
- æ•°æ®å¯¼å‡ºAPI

**Day 3-4**: WebSocketé›†æˆ
- å®æ—¶è¿›åº¦æ¨é€
- çŠ¶æ€åŒæ­¥
- é”™è¯¯é€šçŸ¥

**Day 5**: æ•°æ®æŒä¹…åŒ–
- PostgreSQLé›†æˆ
- Redisç¼“å­˜
- æ•°æ®è¿ç§»

### Week 3: H5ä¼˜åŒ–

**Day 1-3**: åŠŸèƒ½å®Œå–„
- å·¥ä½œæµç¼–è¾‘å™¨ä¼˜åŒ–
- æ¨¡æ¿å¸‚åœº
- åä½œåŠŸèƒ½

**Day 4-5**: æµ‹è¯•å’Œå‘å¸ƒ
- ç«¯åˆ°ç«¯æµ‹è¯•
- æ€§èƒ½ä¼˜åŒ–
- æ–‡æ¡£æ›´æ–°

---

## ğŸ“± å°ç¨‹åºç•Œé¢ç¤ºä¾‹ï¼ˆæ— Canvasï¼‰

```vue
<template>
  <view class="workflow-detail-page">
    <!-- å¤´éƒ¨ä¿¡æ¯ -->
    <view class="workflow-header">
      <text class="workflow-name">{{ workflow.name }}</text>
      <text class="workflow-desc">{{ workflow.description }}</text>
      <view class="workflow-meta">
        <text>{{ workflow.nodes.length }} ä¸ªèŠ‚ç‚¹</text>
        <text>å¹³å‡ {{ workflow.avgExecutionTime }}s</text>
      </view>
    </view>
    
    <!-- èŠ‚ç‚¹æµç¨‹ï¼ˆå‚ç›´åˆ—è¡¨ï¼‰ -->
    <scroll-view scroll-y class="nodes-container">
      <view 
        v-for="(node, index) in workflow.nodes" 
        :key="node.id"
        class="node-item"
        :class="getNodeStatusClass(node.id)"
      >
        <!-- èŠ‚ç‚¹å¡ç‰‡ -->
        <view class="node-card">
          <view class="node-left">
            <text class="node-number">{{ index + 1 }}</text>
            <text class="node-icon">{{ node.icon }}</text>
          </view>
          
          <view class="node-content">
            <text class="node-title">{{ node.data.title }}</text>
            <text class="node-type">{{ node.type }}</text>
            
            <!-- æ‰§è¡ŒçŠ¶æ€ -->
            <view v-if="execution" class="node-status">
              <text 
                v-if="execution.nodeResults[node.id]?.status === 'completed'"
                class="status-completed"
              >
                âœ… å®Œæˆ ({{ execution.nodeResults[node.id].duration }}ms)
              </text>
              <text 
                v-else-if="execution.nodeResults[node.id]?.status === 'running'"
                class="status-running"
              >
                ğŸ”„ è¿è¡Œä¸­...
              </text>
              <text v-else class="status-pending">â³ ç­‰å¾…ä¸­</text>
            </view>
          </view>
          
          <view class="node-right" @tap="showNodeDetail(node)">
            <text class="icon-detail">â€º</text>
          </view>
        </view>
        
        <!-- è¿æ¥ç®­å¤´ -->
        <view v-if="index < workflow.nodes.length - 1" class="connection">
          <view class="connection-line"></view>
          <text class="connection-arrow">â–¼</text>
        </view>
      </view>
    </scroll-view>
    
    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="bottom-actions">
      <button 
        class="btn-execute" 
        :disabled="isExecuting"
        @tap="executeWorkflow"
      >
        <text v-if="!isExecuting">â–¶ï¸ æ‰§è¡Œå·¥ä½œæµ</text>
        <text v-else>â¸ï¸ æ‰§è¡Œä¸­...</text>
      </button>
      <button class="btn-config" @tap="showConfig">
        âš™ï¸ é…ç½®
      </button>
    </view>
  </view>
</template>

<style lang="scss">
.workflow-detail-page {
  height: 100vh;
  background: #f5f5f5;
}

.nodes-container {
  height: calc(100vh - 240rpx);
  padding: 20rpx;
}

.node-item {
  margin-bottom: 20rpx;
}

.node-card {
  background: white;
  border-radius: 16rpx;
  padding: 24rpx;
  display: flex;
  align-items: center;
  box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.05);
}

.node-left {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-right: 20rpx;
}

.node-number {
  width: 48rpx;
  height: 48rpx;
  background: #667eea;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24rpx;
  font-weight: bold;
  margin-bottom: 8rpx;
}

.node-icon {
  font-size: 40rpx;
}

.node-content {
  flex: 1;
}

.node-title {
  font-size: 28rpx;
  font-weight: 500;
  color: #333;
  display: block;
  margin-bottom: 8rpx;
}

.node-type {
  font-size: 24rpx;
  color: #999;
  display: block;
  margin-bottom: 12rpx;
}

.connection {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 8rpx 0;
}

.connection-line {
  width: 4rpx;
  height: 40rpx;
  background: #e0e0e0;
}

.connection-arrow {
  font-size: 32rpx;
  color: #999;
}

.bottom-actions {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 20rpx;
  background: white;
  box-shadow: 0 -4rpx 12rpx rgba(0,0,0,0.05);
  display: flex;
  gap: 20rpx;
}

.btn-execute {
  flex: 2;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 12rpx;
  height: 88rpx;
  font-size: 28rpx;
}

.btn-config {
  flex: 1;
  background: white;
  border: 2rpx solid #e0e0e0;
  border-radius: 12rpx;
  height: 88rpx;
  font-size: 28rpx;
}
</style>
```

---

## âœ… æ€»ç»“

### æ¨èé‡‡ç”¨åŒå‰ç«¯æ¨¡å¼

**ç†ç”±**:
1. âœ… **æŠ€æœ¯æˆç†Ÿ** - H5ç”¨Vue Flowï¼Œå°ç¨‹åºç”¨åŸç”Ÿç»„ä»¶
2. âœ… **æ€§èƒ½ä¼˜ç§€** - å„å–æ‰€é•¿ï¼Œé¿å¼€Canvaså‘
3. âœ… **æ˜“äºç»´æŠ¤** - ä»£ç æ¸…æ™°ï¼Œè°ƒè¯•æ–¹ä¾¿
4. âœ… **ç”¨æˆ·ä½“éªŒ** - å„ç«¯é€‚é…æœ€ä½³äº¤äº’
5. âœ… **å¯æ‰©å±•** - åç»­æ”¯æŒæ›´å¤šå¹³å°

**ä¸æ¨è**:
- âŒ å°ç¨‹åºä½¿ç”¨Canvas - é—®é¢˜å¤ªå¤š
- âŒ å®Œå…¨ç»Ÿä¸€UI - å¼ºè¡Œé€‚é…ä½“éªŒå·®

### ä¸‹ä¸€æ­¥

1. **ç«‹å³è¡ŒåŠ¨**: é‡æ„å°ç¨‹åºå‰ç«¯ï¼Œç§»é™¤Canvas
2. **ä¸­æœŸç›®æ ‡**: å®Œå–„å¤§åç«¯API
3. **é•¿æœŸè§„åˆ’**: H5ç«¯æ·»åŠ æ›´å¤šä¸“ä¸šåŠŸèƒ½

---

**ç»“è®º**: åŒå‰ç«¯+å¤§åç«¯æ˜¯æœ€ä½³æ–¹æ¡ˆï¼ ğŸ¯
