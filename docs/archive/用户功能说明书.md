# 📘 审计数智析 - 用户功能说明书

**版本**: 1.0.0  
**更新日期**: 2025-12-02  
**适用对象**: 审计人员、财务分析师、数据分析师

---

## 目录

1. [系统概述](#系统概述)
2. [节点分类说明](#节点分类说明)
3. [实用工具节点](#实用工具节点)
4. [数据处理节点](#数据处理节点)
5. [审计业务节点](#审计业务节点)
6. [工作流使用指南](#工作流使用指南)
7. [常见应用场景](#常见应用场景)
8. [最佳实践](#最佳实践)

---

## 系统概述

审计数智析是一个基于工作流的审计自动化平台，通过拖拽式节点组合，实现复杂的审计分析流程自动化。

### 核心功能
- 📊 **可视化工作流设计** - 无需编程，拖拽节点即可构建审计流程
- 🔄 **数据自动化处理** - 自动读取、转换、分析审计数据
- 📈 **智能审计分析** - 内置审计业务逻辑，自动发现风险点
- 📝 **报告自动生成** - 自动生成审计报告和分析结果

### 支持的数据格式
- CSV文件
- Excel文件（即将支持）
- JSON数据
- 数据库查询结果（即将支持）

---

## 节点分类说明

系统提供12个核心节点，分为3大类：

| 分类 | 节点数量 | 用途 |
|------|---------|------|
| 🛠️ **实用工具** | 3个 | 基础数据处理和测试 |
| 📊 **数据处理** | 4个 | 数据读取、过滤、转换、聚合 |
| 🔍 **审计业务** | 5个 | 专业审计分析功能 |

---

## 实用工具节点

### 1️⃣ 简单加法 (simple_add)

**图标**: 🧮  
**分类**: 实用工具  
**版本**: 1.0.0

#### 功能说明
将两个数字相加，返回计算结果。主要用于工作流测试和简单数值计算。

#### 输入参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| a | 数字 | ✅ | 第一个加数 |
| b | 数字 | ✅ | 第二个加数 |

#### 输出结果
| 字段名 | 类型 | 说明 |
|--------|------|------|
| result | 数字 | 相加的结果 |

#### 使用示例
```
输入: a = 100, b = 50
输出: result = 150
```

#### 应用场景
- 计算金额总和
- 计算数量累计
- 测试工作流连接
- 验证数据传递

---

### 2️⃣ 简单乘法 (simple_multiply)

**图标**: ✖️  
**分类**: 实用工具  
**版本**: 1.0.0

#### 功能说明
将两个数字相乘，返回计算结果。用于金额计算、比例计算等场景。

#### 输入参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| a | 数字 | ✅ | 被乘数 |
| b | 数字 | ✅ | 乘数 |

#### 输出结果
| 字段名 | 类型 | 说明 |
|--------|------|------|
| result | 数字 | 相乘的结果 |

#### 使用示例
```
输入: a = 100, b = 1.13 (含税率)
输出: result = 113 (含税金额)
```

#### 应用场景
- 计算含税金额
- 计算折扣后价格
- 比例换算
- 单价×数量计算

---

### 3️⃣ 回显节点 (echo)

**图标**: 🔊  
**分类**: 实用工具  
**版本**: 1.0.0

#### 功能说明
原样返回输入数据，用于调试工作流、查看中间结果。

#### 输入参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| data | 任意类型 | ✅ | 要回显的数据 |

#### 输出结果
| 字段名 | 类型 | 说明 |
|--------|------|------|
| echo | 任意类型 | 原样返回的数据 |

#### 使用示例
```
输入: data = { name: "张三", amount: 1000 }
输出: echo = { name: "张三", amount: 1000 }
```

#### 应用场景
- 工作流调试
- 查看中间数据
- 数据格式验证
- 流程测试

---

## 数据处理节点

### 1️⃣ CSV读取器 (data.csv_reader)

**图标**: 📄  
**分类**: 数据输入  
**版本**: 1.0.0

#### 功能说明
读取CSV文件并解析为结构化数据，支持自定义分隔符、编码格式等。

#### 输入参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| filePath | 字符串 | ✅ | CSV文件路径或URL |

#### 配置选项
| 选项名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| delimiter | 字符串 | , | 字段分隔符 |
| hasHeader | 布尔值 | true | 首行是否为表头 |
| encoding | 字符串 | utf-8 | 文件编码格式 |
| skipRows | 数字 | 0 | 跳过开头的行数 |

#### 输出结果
| 字段名 | 类型 | 说明 |
|--------|------|------|
| data | 数组 | 解析后的数据记录 |
| headers | 数组 | 表头字段名 |
| rowCount | 数字 | 数据行数 |

#### 使用示例
```
输入文件: 销售明细.csv
输出: 
  data = [
    { 日期: "2024-01-01", 金额: 1000, 客户: "A公司" },
    { 日期: "2024-01-02", 金额: 2000, 客户: "B公司" }
  ]
  headers = ["日期", "金额", "客户"]
  rowCount = 2
```

#### 应用场景
- 导入审计数据
- 读取账务明细
- 导入发票数据
- 读取银行流水

---

### 2️⃣ 数据过滤器 (data.filter)

**图标**: 🔍  
**分类**: 数据转换  
**版本**: 1.0.0

#### 功能说明
按照指定条件过滤数据行，只保留符合条件的记录。

#### 输入参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| data | 数组 | ✅ | 要过滤的数据 |

#### 配置选项
| 选项名 | 类型 | 说明 |
|--------|------|------|
| field | 字符串 | 过滤字段名 |
| operator | 字符串 | 比较运算符 (==, !=, >, <, >=, <=, contains) |
| value | 任意类型 | 比较值 |

#### 输出结果
| 字段名 | 类型 | 说明 |
|--------|------|------|
| filtered | 数组 | 过滤后的数据 |
| filteredCount | 数字 | 保留的记录数 |
| removedCount | 数字 | 移除的记录数 |

#### 使用示例
```
输入数据: [
  { 金额: 1000, 类型: "收入" },
  { 金额: 500, 类型: "支出" },
  { 金额: 2000, 类型: "收入" }
]

过滤条件: field="金额", operator=">", value=800

输出: 
  filtered = [
    { 金额: 1000, 类型: "收入" },
    { 金额: 2000, 类型: "收入" }
  ]
  filteredCount = 2
  removedCount = 1
```

#### 应用场景
- 筛选大额交易
- 过滤异常数据
- 选择特定时间段
- 筛选特定供应商

---

### 3️⃣ 数据映射器 (data.map)

**图标**: 🔄  
**分类**: 数据转换  
**版本**: 1.0.0

#### 功能说明
转换和重命名数据字段，计算派生字段。

#### 输入参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| data | 数组 | ✅ | 要转换的数据 |

#### 配置选项
| 选项名 | 类型 | 说明 |
|--------|------|------|
| mappings | 对象 | 字段映射规则 { 新字段名: "原字段名" } |
| calculations | 对象 | 计算字段 { 字段名: "表达式" } |

#### 输出结果
| 字段名 | 类型 | 说明 |
|--------|------|------|
| mapped | 数组 | 转换后的数据 |

#### 使用示例
```
输入数据: [
  { 单价: 100, 数量: 10, 税率: 0.13 }
]

映射配置:
  mappings = { price: "单价", qty: "数量" }
  calculations = { total: "price * qty", tax: "total * 0.13" }

输出:
  mapped = [
    { price: 100, qty: 10, total: 1000, tax: 130 }
  ]
```

#### 应用场景
- 字段重命名
- 计算含税金额
- 数据格式转换
- 添加计算字段

---

### 4️⃣ 数据聚合器 (data.aggregate)

**图标**: 📊  
**分类**: 数据转换  
**版本**: 1.0.0

#### 功能说明
按字段分组并进行聚合计算（求和、计数、平均值等）。

#### 输入参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| data | 数组 | ✅ | 要聚合的数据 |

#### 配置选项
| 选项名 | 类型 | 说明 |
|--------|------|------|
| groupBy | 字符串/数组 | 分组字段 |
| aggregations | 对象 | 聚合函数 { 字段名: "sum/count/avg/min/max" } |

#### 输出结果
| 字段名 | 类型 | 说明 |
|--------|------|------|
| aggregated | 数组 | 聚合后的数据 |

#### 使用示例
```
输入数据: [
  { 部门: "销售部", 金额: 1000 },
  { 部门: "销售部", 金额: 2000 },
  { 部门: "财务部", 金额: 1500 }
]

聚合配置:
  groupBy = "部门"
  aggregations = { 
    总金额: "sum:金额",
    交易次数: "count",
    平均金额: "avg:金额"
  }

输出:
  aggregated = [
    { 部门: "销售部", 总金额: 3000, 交易次数: 2, 平均金额: 1500 },
    { 部门: "财务部", 总金额: 1500, 交易次数: 1, 平均金额: 1500 }
  ]
```

#### 应用场景
- 部门汇总统计
- 供应商金额汇总
- 月度/年度汇总
- 分类统计分析

---

## 审计业务节点

### 1️⃣ 数据对比 (audit.data_compare)

**图标**: 📊  
**分类**: 审计分析  
**版本**: 1.0.0

#### 功能说明
对比两组数据，找出差异、缺失和多余的记录，常用于账实核对。

#### 输入参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| source1 | 数组 | ✅ | 数据源1（如账面数据） |
| source2 | 数组 | ✅ | 数据源2（如实际数据） |
| keyField | 字符串 | ✅ | 主键字段名 |

#### 配置选项
| 选项名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| compareFields | 数组 | [] | 需要对比的字段列表 |
| ignoreCase | 布尔值 | false | 是否忽略大小写 |

#### 输出结果
| 字段名 | 类型 | 说明 |
|--------|------|------|
| matches | 数组 | 完全匹配的记录 |
| onlyInSource1 | 数组 | 仅在数据源1中存在 |
| onlyInSource2 | 数组 | 仅在数据源2中存在 |
| differences | 数组 | 主键相同但值不同的记录 |

#### 使用示例
```
账面数据: [
  { 编号: "001", 金额: 1000, 状态: "已付款" },
  { 编号: "002", 金额: 2000, 状态: "已付款" }
]

实际数据: [
  { 编号: "001", 金额: 1000, 状态: "已付款" },
  { 编号: "003", 金额: 3000, 状态: "已付款" }
]

对比结果:
  matches = [{ 编号: "001", ... }]
  onlyInSource1 = [{ 编号: "002", ... }]
  onlyInSource2 = [{ 编号: "003", ... }]
```

#### 应用场景
- 账实核对
- 库存盘点对比
- 银行对账
- 系统数据核对

---

### 2️⃣ 金额计算 (audit.amount_calculate)

**图标**: 💰  
**分类**: 审计分析  
**版本**: 1.0.0

#### 功能说明
对金额数据进行统计计算，包括求和、平均值、最大最小值等。

#### 输入参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| data | 数组 | ✅ | 包含金额的数据 |

#### 配置选项
| 选项名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| amountField | 字符串 | amount | 金额字段名 |
| operations | 数组 | [sum] | 要执行的计算 (sum, avg, max, min, count) |

#### 输出结果
| 字段名 | 类型 | 说明 |
|--------|------|------|
| sum | 数字 | 金额总和 |
| average | 数字 | 平均金额 |
| max | 数字 | 最大金额 |
| min | 数字 | 最小金额 |
| count | 数字 | 记录数量 |

#### 使用示例
```
输入数据: [
  { 交易ID: "001", 金额: 1000 },
  { 交易ID: "002", 金额: 2000 },
  { 交易ID: "003", 金额: 500 }
]

输出结果:
  sum = 3500
  average = 1166.67
  max = 2000
  min = 500
  count = 3
```

#### 应用场景
- 收入支出汇总
- 平均交易金额分析
- 异常金额识别
- 财务指标计算

---

### 3️⃣ 审计抽样 (audit.sampling)

**图标**: 🎲  
**分类**: 审计分析  
**版本**: 1.0.0

#### 功能说明
按照审计要求进行数据抽样，支持随机抽样、系统抽样等方法。

#### 输入参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| data | 数组 | ✅ | 总体数据 |

#### 配置选项
| 选项名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| method | 字符串 | random | 抽样方法 (random/systematic/stratified) |
| sampleSize | 数字 | 30 | 样本数量 |
| sampleRate | 数字 | - | 抽样比例 (0-1) |

#### 输出结果
| 字段名 | 类型 | 说明 |
|--------|------|------|
| samples | 数组 | 抽样结果 |
| sampleSize | 数字 | 实际抽样数量 |
| totalSize | 数字 | 总体数量 |
| samplingRate | 数字 | 实际抽样率 |

#### 使用示例
```
输入数据: 1000条交易记录

配置:
  method = "random"
  sampleSize = 50

输出:
  samples = [随机选择的50条记录]
  sampleSize = 50
  totalSize = 1000
  samplingRate = 0.05 (5%)
```

#### 应用场景
- 审计样本选择
- 凭证抽查
- 发票抽检
- 交易测试

---

### 4️⃣ 凭证分析 (audit.voucher_analysis)

**图标**: 📝  
**分类**: 业务审计  
**版本**: 1.0.0

#### 功能说明
分析会计凭证的完整性和合规性，检查借贷平衡、附件完整性等。

#### 输入参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| vouchers | 数组 | ✅ | 凭证列表 |

#### 配置选项
| 选项名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| checkBalance | 布尔值 | true | 检查借贷平衡 |
| checkAttachments | 布尔值 | true | 检查附件完整性 |
| checkApproval | 布尔值 | false | 检查审批流程 |

#### 输出结果
| 字段名 | 类型 | 说明 |
|--------|------|------|
| totalCount | 数字 | 凭证总数 |
| validCount | 数字 | 有效凭证数 |
| invalidCount | 数字 | 无效凭证数 |
| issues | 数组 | 发现的问题列表 |
| riskLevel | 字符串 | 风险等级 (low/medium/high) |

#### 使用示例
```
输入: 100张凭证

输出:
  totalCount = 100
  validCount = 95
  invalidCount = 5
  issues = [
    { 凭证号: "V001", 问题: "借贷不平衡", 差额: 100 },
    { 凭证号: "V025", 问题: "缺少附件" }
  ]
  riskLevel = "low"
```

#### 应用场景
- 凭证合规性检查
- 记账准确性审计
- 附件完整性核查
- 审批流程审计

---

### 5️⃣ 发票验证 (audit.invoice_validation)

**图标**: 🧾  
**分类**: 业务审计  
**版本**: 1.0.0

#### 功能说明
验证发票的真实性和合规性，检查发票号、税号、金额等要素。

#### 输入参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| invoices | 数组 | ✅ | 发票列表 |

#### 配置选项
| 选项名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| checkFormat | 布尔值 | true | 检查格式 |
| checkAmount | 布尔值 | true | 检查金额计算 |
| checkTaxCode | 布尔值 | true | 检查税号格式 |

#### 输出结果
| 字段名 | 类型 | 说明 |
|--------|------|------|
| validInvoices | 数组 | 有效发票 |
| invalidInvoices | 数组 | 无效发票 |
| validationRate | 数字 | 验证通过率 (%) |
| issues | 数组 | 问题列表 |

#### 使用示例
```
输入: 50张发票

输出:
  validInvoices = [45张有效发票]
  invalidInvoices = [5张无效发票]
  validationRate = 90
  issues = [
    { 发票号: "INV001", 问题: ["税号格式错误"] },
    { 发票号: "INV012", 问题: ["金额计算错误"] }
  ]
```

#### 应用场景
- 发票真伪验证
- 进项税额核查
- 发票合规性审查
- 费用报销审核

---

## 工作流使用指南

### 创建工作流的基本步骤

1. **新建工作流**
   - 进入项目管理
   - 点击"新建工作流"
   - 输入工作流名称和描述

2. **添加节点**
   - 从左侧节点库拖拽节点到画布
   - 或双击节点直接添加

3. **配置节点**
   - 点击节点打开配置面板
   - 填写必要的参数和选项
   - 设置节点名称（可选）

4. **连接节点**
   - 拖拽节点输出端点到另一个节点输入端点
   - 创建数据流连接

5. **运行测试**
   - 点击"运行"按钮
   - 查看执行结果
   - 检查每个节点的输出

6. **保存工作流**
   - 点击"保存"按钮
   - 工作流自动保存到项目中

---

## 常见应用场景

### 场景1：银行对账

**目标**: 核对银行流水与账面记录

**工作流设计**:
```
CSV读取器(银行流水) ─┐
                    ├─> 数据对比 -> 结果展示
CSV读取器(账面记录) ─┘
```

**步骤说明**:
1. 使用两个CSV读取器分别读取银行流水和账面记录
2. 使用数据对比节点，以交易流水号为主键进行对比
3. 查看差异记录，找出未达账项

---

### 场景2：大额交易分析

**目标**: 筛选并分析大额交易

**工作流设计**:
```
CSV读取器 -> 数据过滤(金额>10000) -> 金额计算 -> 结果展示
```

**步骤说明**:
1. 读取交易数据
2. 过滤出金额大于10000的交易
3. 计算大额交易的总金额、平均金额等统计指标

---

### 场景3：部门费用汇总

**目标**: 按部门统计费用支出

**工作流设计**:
```
CSV读取器 -> 数据聚合(按部门分组) -> 结果展示
```

**步骤说明**:
1. 读取费用数据
2. 按部门字段分组
3. 聚合计算各部门总费用、平均费用、费用次数

---

### 场景4：发票合规性检查

**工作流设计**:
```
CSV读取器(发票数据) -> 发票验证 -> 数据过滤(无效发票) -> 结果导出
```

**步骤说明**:
1. 读取发票数据
2. 使用发票验证节点检查合规性
3. 过滤出无效发票
4. 导出问题发票清单

---

### 场景5：审计抽样检查

**工作流设计**:
```
CSV读取器 -> 审计抽样(5%随机抽样) -> 凭证分析 -> 结果展示
```

**步骤说明**:
1. 读取全部凭证
2. 进行5%的随机抽样
3. 对抽样结果进行详细分析
4. 生成审计报告

---

## 最佳实践

### 1. 工作流设计原则

✅ **模块化设计**
- 将复杂流程拆分为多个小工作流
- 每个工作流专注于一个特定任务
- 便于复用和维护

✅ **数据验证**
- 在处理前先验证数据格式和完整性
- 使用过滤节点去除无效数据
- 添加数据质量检查节点

✅ **错误处理**
- 为关键节点添加错误处理逻辑
- 记录异常情况和错误日志
- 设置合理的超时时间

### 2. 性能优化建议

⚡ **减少数据传输**
- 尽早过滤不需要的数据
- 只选择必要的字段
- 避免重复读取相同数据

⚡ **合理使用缓存**
- 对不常变化的数据启用缓存
- 设置合适的缓存时间
- 定期清理过期缓存

⚡ **批量处理**
- 尽可能批量处理数据
- 避免逐条记录处理
- 使用聚合节点代替循环

### 3. 数据安全

🔒 **敏感数据保护**
- 不在工作流中硬编码敏感信息
- 使用环境变量存储密码和密钥
- 定期备份重要数据

🔒 **访问控制**
- 为工作流设置适当的权限
- 限制敏感数据的访问范围
- 记录所有数据访问日志

### 4. 文档和注释

📝 **添加说明**
- 为复杂的工作流添加说明文档
- 为每个节点添加注释说明其用途
- 记录重要的配置参数

📝 **版本管理**
- 为重要修改创建新版本
- 记录每个版本的变更内容
- 保留历史版本以便回滚

---

## 常见问题 FAQ

### Q1: 节点执行失败怎么办？
**A**: 
1. 检查节点配置是否正确
2. 查看节点输入数据是否符合要求
3. 检查上游节点是否执行成功
4. 查看错误日志获取详细信息

### Q2: 如何处理大数据量？
**A**:
1. 尽早过滤数据，减少处理量
2. 使用分页读取数据
3. 考虑分批次处理
4. 启用数据缓存

### Q3: 工作流可以定时执行吗？
**A**:
目前版本需要手动触发，定时执行功能将在后续版本中提供。

### Q4: 支持哪些数据源？
**A**:
当前支持CSV文件，Excel和数据库支持即将推出。

### Q5: 如何导出分析结果？
**A**:
在工作流执行完成后，可以在结果页面导出为CSV或JSON格式。

---

## 联系支持

如有任何问题或建议，请联系：

📧 **技术支持**: support@audit-analytics.com  
📱 **用户社区**: https://community.audit-analytics.com  
📚 **在线文档**: https://docs.audit-analytics.com

---

**版权所有 © 2025 审计数智析团队**
