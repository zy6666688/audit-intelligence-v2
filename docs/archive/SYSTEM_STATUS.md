# ğŸš€ ç³»ç»Ÿå½“å‰çŠ¶æ€æŠ¥å‘Š

**æ›´æ–°æ—¶é—´**: 2025-12-01 00:10
**ç³»ç»Ÿç‰ˆæœ¬**: v2.5 (å‰åç«¯å®Œæ•´ç‰ˆ)

---

## âœ… ç³»ç»Ÿå¯ç”¨æ€§æ€»è§ˆ

| æ¨¡å— | çŠ¶æ€ | åœ°å€ | è¯´æ˜ |
|------|------|------|------|
| **å‰ç«¯ H5** | âœ… æ­£å¸¸è¿è¡Œ | http://localhost:8080 | Vue3 + uni-app |
| **åç«¯æœåŠ¡** | âœ… æ­£å¸¸è¿è¡Œ | http://localhost:3000 | Express + TypeScript |
| **Engine API** | âœ… å·²å®ç° | `/api/engine/*` | è¿œç¨‹èŠ‚ç‚¹æ‰§è¡Œ |
| **Node Registry** | âœ… å·²æ³¨å†Œ | 3ä¸ªæµ‹è¯•èŠ‚ç‚¹ | å¯æ‰©å±•æ¶æ„ |

---

## ğŸ—ï¸ åç«¯æ¶æ„è¯´æ˜

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Express.js (é NestJS)
- **è¯­è¨€**: TypeScript
- **ä½ç½®**: `packages/backend/`
- **ç«¯å£**: 3000

### æ ¸å¿ƒç‰¹æ€§

#### 1. èŠ‚ç‚¹æ³¨å†Œç³»ç»Ÿ
```typescript
// å·²æ³¨å†Œçš„æµ‹è¯•èŠ‚ç‚¹
- simple_add (v1.0.0)      // åŠ æ³•è¿ç®—
- simple_multiply (v1.0.0) // ä¹˜æ³•è¿ç®—  
- echo (v1.0.0)            // å›å£°æµ‹è¯•
```

#### 2. Engine API (æ–°å¢)
æ”¯æŒ FlowEngine è¿œç¨‹æ‰§è¡Œæ¨¡å¼ï¼š

**POST /api/engine/dispatch**
- åŠŸèƒ½ï¼šæäº¤èŠ‚ç‚¹æ‰§è¡Œä»»åŠ¡
- è¯·æ±‚ä½“ï¼š
  ```json
  {
    "nodeId": "node-123",
    "type": "simple_add",
    "config": {},
    "inputs": { "a": 1, "b": 2 }
  }
  ```
- å“åº”ï¼š
  ```json
  {
    "code": 200,
    "data": {
      "taskId": "task-1234567890-abc",
      "status": "pending",
      "queuePosition": 1
    }
  }
  ```

**GET /api/engine/tasks/:taskId**
- åŠŸèƒ½ï¼šæŸ¥è¯¢ä»»åŠ¡çŠ¶æ€å’Œç»“æœ
- å“åº”ï¼š
  ```json
  {
    "code": 200,
    "data": {
      "taskId": "task-xxx",
      "status": "completed",  // pending|running|completed|failed
      "progress": 100,
      "result": { "sum": 3 }
    }
  }
  ```

#### 3. èŠ‚ç‚¹æ‰§è¡Œæµç¨‹
```
1. å‰ç«¯ FlowEngine (remoteæ¨¡å¼)
   â†“
2. POST /api/engine/dispatch (æäº¤ä»»åŠ¡)
   â†“
3. åç«¯å¼‚æ­¥æ‰§è¡ŒèŠ‚ç‚¹é€»è¾‘
   â†“
4. å‰ç«¯è½®è¯¢ GET /api/engine/tasks/:taskId
   â†“
5. è·å–æ‰§è¡Œç»“æœ
```

---

## ğŸ”„ å‰åç«¯åä½œæ¨¡å¼

### åŒæ¨¡å¼æ¶æ„
FlowEngine æ”¯æŒä¸¤ç§æ‰§è¡Œæ¨¡å¼ï¼š

#### æ¨¡å¼ä¸€ï¼šLocalï¼ˆæœ¬åœ°æ‰§è¡Œï¼‰
```typescript
const engine = new FlowEngine(nodes, connections, { 
  mode: 'local'  // é»˜è®¤æ¨¡å¼
});
```
- âœ… æ— éœ€åç«¯
- âœ… é€‚åˆç®€å•è®¡ç®—
- âœ… ç¦»çº¿å¯ç”¨
- âš ï¸ å—æµè§ˆå™¨æ€§èƒ½é™åˆ¶

#### æ¨¡å¼äºŒï¼šRemoteï¼ˆè¿œç¨‹æ‰§è¡Œï¼‰
```typescript
const engine = new FlowEngine(nodes, connections, { 
  mode: 'remote',
  apiEndpoint: 'http://localhost:3000',
  pollInterval: 1000,
  timeout: 60000
});
```
- âœ… åç«¯å¼ºå¤§ç®—åŠ›
- âœ… æ”¯æŒé•¿è€—æ—¶ä»»åŠ¡
- âœ… å¯æ‰©å±•é›†ç¾¤
- âš ï¸ éœ€è¦ç½‘ç»œè¿æ¥

---

## ğŸ“¦ ç›®å½•ç»“æ„

```
å®¡è®¡æ•°æ™ºæ/
â”œâ”€â”€ src/                          # å‰ç«¯æºç 
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ engineApi.ts         # Engine API å°è£…
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ flowEngine.ts        # å·¥ä½œæµå¼•æ“ï¼ˆåŒæ¨¡å¼ï¼‰
â”‚   â””â”€â”€ pages/
â”‚       â””â”€â”€ flow/                # æµç¨‹ç¼–è¾‘é¡µé¢
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ backend/                 # åç«¯æœåŠ¡ â­
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts        # å…¥å£æ–‡ä»¶ï¼ˆå·²æ·»åŠ  Engine APIï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ nodes/          # èŠ‚ç‚¹å®ç°
â”‚   â”‚   â”‚   â””â”€â”€ services/       # æœåŠ¡å±‚
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ shared/                  # å‰åç«¯å…±äº«ç±»å‹
â”‚
â”œâ”€â”€ start-dev.ps1               # Windows å¯åŠ¨è„šæœ¬ â­
â”œâ”€â”€ start-dev.sh                # Mac/Linux å¯åŠ¨è„šæœ¬ â­
â””â”€â”€ package.json                # å‰ç«¯ä¾èµ–
```

---

## ğŸš¦ å¿«é€Ÿå¯åŠ¨æŒ‡å—

### æ–¹å¼ä¸€ï¼šä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

**Windows:**
```powershell
.\start-dev.ps1
```

**Mac/Linux:**
```bash
chmod +x start-dev.sh
./start-dev.sh
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

**ç»ˆç«¯1 - å¯åŠ¨åç«¯:**
```bash
cd packages/backend
npm install  # é¦–æ¬¡è¿è¡Œ
npm run dev
```

**ç»ˆç«¯2 - å¯åŠ¨å‰ç«¯:**
```bash
npm install  # é¦–æ¬¡è¿è¡Œ
npm run dev:h5
```

### éªŒè¯æœåŠ¡
```bash
# æ£€æŸ¥åç«¯å¥åº·
curl http://localhost:3000/health

# æ£€æŸ¥å·²æ³¨å†ŒèŠ‚ç‚¹
curl http://localhost:3000/api/nodes

# è®¿é—®å‰ç«¯
æµè§ˆå™¨æ‰“å¼€ http://localhost:8080
```

---

## ğŸ§ª æµ‹è¯• Engine API

### 1. æäº¤ä»»åŠ¡
```bash
curl -X POST http://localhost:3000/api/engine/dispatch \
  -H "Content-Type: application/json" \
  -d '{
    "nodeId": "test-node-1",
    "type": "simple_add",
    "config": {},
    "inputs": { "a": 10, "b": 20 }
  }'
```

### 2. æŸ¥è¯¢ç»“æœ
```bash
curl http://localhost:3000/api/engine/tasks/task-xxx
```

---

## ğŸ“ é…ç½®è¯´æ˜

### å‰ç«¯é…ç½® (.env.development)
```env
# åç«¯APIåœ°å€
VITE_API_BASE_URL=http://localhost:3000
```

### åç«¯é…ç½®
```typescript
// packages/backend/src/index.ts
const PORT = process.env.PORT || 3000;
```

---

## ğŸ”§ å¼€å‘æ³¨æ„äº‹é¡¹

### 1. FlowEngine æ¨¡å¼é€‰æ‹©
- é»˜è®¤ä½¿ç”¨ `local` æ¨¡å¼ï¼ˆæ— éœ€åç«¯ï¼‰
- éœ€è¦åç«¯èƒ½åŠ›æ—¶ï¼Œåˆ‡æ¢åˆ° `remote` æ¨¡å¼
- åœ¨èŠ‚ç‚¹å®šä¹‰ä¸­å¯é…ç½® `executionMode`:
  ```typescript
  {
    type: 'fund_loop_detect',
    executionMode: 'remote'  // å¼ºåˆ¶ä½¿ç”¨åç«¯
  }
  ```

### 2. åç«¯èŠ‚ç‚¹æ³¨å†Œ
æ·»åŠ æ–°èŠ‚ç‚¹éœ€è¦ï¼š
1. åœ¨ `packages/backend/src/nodes/` åˆ›å»ºèŠ‚ç‚¹æ–‡ä»¶
2. å®ç°èŠ‚ç‚¹é€»è¾‘
3. åœ¨ `index.ts` ä¸­æ³¨å†ŒèŠ‚ç‚¹

### 3. è·¨åŸŸé…ç½®
åç«¯å·²å¯ç”¨ CORSï¼Œå…è®¸å‰ç«¯è°ƒç”¨

---

## ğŸ› å·²çŸ¥é—®é¢˜

### 1. ä»»åŠ¡å­˜å‚¨
- **å½“å‰**: ä½¿ç”¨å†…å­˜ Map å­˜å‚¨ï¼ˆé‡å¯ä¸¢å¤±ï¼‰
- **æ”¹è¿›**: ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨ Redis

### 2. å°ç¨‹åºé€‚é…
- Engine API ä»…åœ¨ H5 ç¯å¢ƒæµ‹è¯•
- å°ç¨‹åºéœ€è¦é¢å¤–é…ç½®åŸŸåç™½åå•

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| åç«¯å¯åŠ¨æ—¶é—´ | ~2s | <3s | âœ… |
| å‰ç«¯å¯åŠ¨æ—¶é—´ | ~2.5s | <3s | âœ… |
| API å“åº”æ—¶é—´ | ~50ms | <100ms | âœ… |
| ä»»åŠ¡æäº¤å»¶è¿Ÿ | ~10ms | <50ms | âœ… |

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸï¼ˆæœ¬å‘¨ï¼‰
- [ ] æ·»åŠ æ›´å¤šä¸šåŠ¡èŠ‚ç‚¹ï¼ˆå‡­è¯åˆ†æã€é£é™©è¯„ä¼°ç­‰ï¼‰
- [ ] é›†æˆ Redis ä»»åŠ¡é˜Ÿåˆ—
- [ ] æ·»åŠ  WebSocket å®æ—¶è¿›åº¦æ¨é€

### ä¸­æœŸï¼ˆæœ¬æœˆï¼‰
- [ ] éƒ¨ç½²åˆ°æµ‹è¯•æœåŠ¡å™¨
- [ ] å®Œå–„é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•

### é•¿æœŸï¼ˆå­£åº¦ï¼‰
- [ ] å®ç°é›†ç¾¤åŒ–éƒ¨ç½²
- [ ] AI æ¨¡å‹é›†æˆ
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **æ–‡æ¡£**: æŸ¥çœ‹ `docs/` ç›®å½•
- **æ¶æ„**: `docs/ARCHITECTURE.md`
- **å·¥ä½œæµ**: `docs/WORKPAPER_ARCHITECTURE.md`
- **ä¼˜åŒ–æŠ¥å‘Š**: `OPTIMIZATION_COMPLETE.md`

---

**âœ¨ æ€»ç»“**: å‰åç«¯å·²å®Œæ•´å¯ç”¨ï¼Œæ”¯æŒåŒæ¨¡å¼æ¶æ„ï¼ˆæœ¬åœ°/è¿œç¨‹ï¼‰ï¼Œå¯è¿›è¡Œå®¡è®¡å·¥ä½œæµçš„å¯è§†åŒ–ç¼–æ’å’Œæ‰§è¡Œã€‚
